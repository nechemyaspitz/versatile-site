!function(){"use strict";const t=new Set,e=(e,i={})=>t.has(e)?Promise.resolve():new Promise((r,a)=>{const s=document.createElement("script");s.src=e,s.async=!0,Object.entries(i).forEach(([t,e])=>s.setAttribute(t,e)),s.onload=()=>{t.add(e),r()},s.onerror=a,document.head.appendChild(s)}),i=e=>t.has(e)?Promise.resolve():new Promise((i,r)=>{const a=document.createElement("link");a.rel="stylesheet",a.href=e,a.onload=()=>{t.add(e),i()},a.onerror=r,document.head.appendChild(a)}),r=new Map,a=(t,e)=>r.set(t,e),s=t=>r.get(t)||{},n=t=>r.delete(t),o=new Map;async function l(t){window.gsap||await e("https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"),await i("https://cdn.jsdelivr.net/npm/swiper@12/swiper-bundle.min.css"),window.Swiper||await e("https://cdn.jsdelivr.net/npm/swiper@12/swiper-bundle.min.js");const r=document.querySelector(".swiper");if(!r)return void a("home",{destroy:()=>{}});const s=window.matchMedia("(prefers-reduced-motion: reduce)").matches,n=s?0:1.45;let o=null,l=null,c=null,d=!1,u=0;if(window.SplitText&&window.gsap&&gsap.registerPlugin)try{gsap.registerPlugin(SplitText)}catch(t){}function h(t){if(!t||!window.SplitText)return null;if(t.__split)return t.__split;const e=t.querySelector(".slider-product-name");if(!e)return null;const i=new SplitText(e,{type:"chars"});return t.__split=i,gsap.set(i.chars,{yPercent:120,rotate:6,opacity:0,transformOrigin:"0% 100%",willChange:"transform, opacity"}),i}function p(t){const e=h(t);e&&(gsap.killTweensOf(e.chars),gsap.to(e.chars,{yPercent:0,rotate:0,opacity:1,duration:.9,ease:"power3.out",stagger:{each:.02,from:"start"}}))}function m(t,e){const i=t.slides[e].swiperSlideOffset||0;return t.rtlTranslate?i:-i}function g(t,e){s||(t.setTranslate(e),t.slides.forEach(t=>{const e=t.querySelector(".slider-img");if(!e)return;const i="number"==typeof t.progress?t.progress:0;gsap.set(e,{xPercent:28*i})}))}function f(){c&&(c.kill(),c=null)}function y(t){f(),s||(c=gsap.delayedCall(4.2,t))}function b(t,e="next"){if(!o)return;f(),l&&(l.kill(),l=null);const i=function(t){let e=-1;return t.slides.forEach(t=>{const i=parseInt(t.getAttribute("data-swiper-slide-index")||"0",10);!Number.isNaN(i)&&i>e&&(e=i)}),e+1}(t),r=t.activeIndex,a=t.slides[r];let s;s="next"===e?(t.realIndex+1)%i:"prev"===e?(t.realIndex-1+i)%i:"number"==typeof e?(e%i+i)%i:(t.realIndex+1)%i,t.updateSlides(),t.updateSlidesOffset();const c=function(t,e,i){let r=-1,a=1/0;return t.slides.forEach((s,n)=>{if(parseInt(s.getAttribute("data-swiper-slide-index")||"-1",10)!==e)return;const o=m(t,n),l=Math.abs(o-i);l<a&&(a=l,r=n)}),r}(t,s,u);t.slideTo(c,0,!1),t.updateSlides(),t.updateSlidesOffset();const d=t.activeIndex,v=t.slides[d],w=u;let S=m(t,d);if(w===S){const e=t.rtlTranslate?-1:1;S-=e*t.width}l=gsap.timeline({onUpdate:()=>{const e=gsap.getProperty(o,"x");g(t,e)},onComplete:()=>{u=S,y(()=>b(t,"next"))}}),function(t){const e=h(t);e&&(gsap.killTweensOf(e.chars),gsap.to(e.chars,{yPercent:-120,rotate:-4,opacity:0,duration:.5,ease:"power2.in",stagger:{each:.015,from:"end"},onComplete:()=>{gsap.set(e.chars,{yPercent:120,rotate:6,opacity:0})}}))}(a),function(t){const e=h(t);e&&(gsap.killTweensOf(e.chars),gsap.set(e.chars,{yPercent:120,rotate:6,opacity:0}))}(v),l.fromTo(o,{x:w},{x:S,duration:n,ease:"power4.inOut"},0),l.add(()=>p(v),.3*n)}const v=new Swiper(".swiper",{loop:!0,slidesPerView:1,allowTouchMove:!1,speed:0,virtualTranslate:!0,watchSlidesProgress:!0,on:{init(t){o=t.el.querySelector(".swiper-wrapper"),t.slides.forEach(h),t.updateSlides(),t.updateSlidesOffset(),u=m(t,t.activeIndex),gsap.set(o,{x:u,willChange:"transform",force3D:!0}),g(t,u),function(t){if(d||s)return;const e=t.slides[t.activeIndex],i=e?.querySelector(".slider-img");i&&gsap.fromTo(i,{scale:1.12},{scale:1,duration:1,ease:"power2.out"}),p(e),d=!0}(t),y(()=>b(t,"next"))},resize(t){t.updateSlides(),t.updateSlidesOffset(),u=m(t,t.activeIndex),gsap.set(o,{x:u}),g(t,u)}}}),w=()=>{document.hidden?f():y(()=>b(v,"next"))};document.addEventListener("visibilitychange",w);const S=()=>f(),x=()=>y(()=>b(v,"next"));r.addEventListener("mouseenter",S),r.addEventListener("mouseleave",x),a("home",{destroy:()=>{try{document.removeEventListener("visibilitychange",w),r.removeEventListener("mouseenter",S),r.removeEventListener("mouseleave",x)}catch(t){}try{f()}catch(t){}try{l?.kill?.()}catch(t){}try{v?.destroy?.(!0,!0)}catch(t){}}})}function c(){c._ac?.abort?.();const t=new AbortController;c._ac=t;const e=document.querySelector("#filters-open"),i=document.querySelector(".close-filters"),r=document.querySelector(".filter-drawer"),a=document.querySelector(".filter-controls");r&&a&&window.gsap&&(gsap.set(r,{display:"none",opacity:0}),gsap.set(a,{xPercent:100}),e&&e.addEventListener("click",()=>{gsap.set(r,{display:"flex"});gsap.timeline({defaults:{ease:"power1.inOut"}}).to(r,{opacity:1,duration:.1}).to(a,{xPercent:0,ease:"power4.out",duration:.4},.06)},{signal:t.signal}),i&&i.addEventListener("click",()=>{gsap.timeline({defaults:{ease:"power1.inOut",duration:.1},onComplete:()=>gsap.set(r,{display:"none"})}).to(a,{xPercent:100,ease:"power4.in",duration:.2}).to(r,{opacity:0,duration:.05},"-=0.1")},{signal:t.signal}))}async function d(t){window.gsap||await e("https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"),await i("https://cdn.jsdelivr.net/npm/nice-select2@2.1.0/dist/css/nice-select2.css"),window.NiceSelect||await e("https://cdn.jsdelivr.net/npm/nice-select2@2.1.0/dist/js/nice-select2.js");const r=document.querySelector(".product-grid"),s=document.getElementById("filters");if(!r||!s)return void a("collections",{destroy:()=>{}});c();const n=new class{constructor(){this.productContainer=document.querySelector(".product-grid"),this.filterForm=document.getElementById("filters"),this.sortDropdown=document.getElementById("sort-select"),this.resultsCounter=document.querySelector("[data-results-count]"),this.clearButton=document.querySelector(".button.alt"),this.collectionId="c09bba8e-4a81-49c2-b722-f1fa46c75861",this.baseUrl="https://wmkcwljhyweqzjivbupx.supabase.co/functions/v1/generic-collection-filter",this.activeFilters={},this.currentSort="recommended",this.currentPage=1,this.itemsPerPage=30,this.isLoading=!1,this.hasMorePages=!0,this.totalItems=0,this.niceSelect=null,this._ac=new AbortController,this._observer=null,this._sentinel=null,this._respCache=new Map,this.init()}async init(){try{this.initNiceSelect(),this.loadFromURLParams(),this.initEventListeners(),this.initInfiniteScroll(),await this.loadInitialData()}catch(t){console.error("Error initializing filter:",t),this.handleError(t)}}async loadInitialData(){this.currentPage=1,this.hasMorePages=!0,this.clearProductContainer(),await this.fetchItems()}async fetchItems(t=!1){if(!this.isLoading){this.isLoading=!0;try{const e=this.buildRequestUrl();if(this._respCache.has(e)){const i=this._respCache.get(e);return t?this.appendItems(i.items):this.renderItems(i.items),this.updatePagination(i.pagination),this.updateResultsCounter(i.pagination.total),this.updateClearButton(),void(this.isLoading=!1)}const i=await fetch(e);if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);const r=await this.handleResponse(i);this._respCache.set(e,r),t?this.appendItems(r.items):this.renderItems(r.items),this.updatePagination(r.pagination),this.updateResultsCounter(r.pagination.total),this.updateClearButton()}catch(t){console.error("Fetch error:",t),this.handleError(t)}finally{this.isLoading=!1}}}async handleResponse(t){const e=await t.text();if(!t.ok){if(403===t.status)throw new Error("Access denied. Please contact support.");throw new Error(`Server error: ${t.status} ${t.statusText}`)}try{return JSON.parse(e)}catch(t){throw console.error("JSON parse error:",t),console.error("Response text:",e),new Error("Invalid response format from server")}}buildRequestUrl(){const t=new URLSearchParams({collection_id:this.collectionId,page:this.currentPage.toString(),limit:this.itemsPerPage.toString(),sort:this.currentSort});Object.entries(this.activeFilters).forEach(([e,i])=>{if(i.length>0){const r={application:"application-slugs",material:"material",featured:"featured",thickness:"thickness"};if(["colors","color","size","finish"].includes(e))t.set(`filter_${e}`,i.join(","));else{const a=r[e]||e;t.set(`filter_${a}`,i.join(","))}}});return t.set("config",JSON.stringify({searchFields:["name","description","actual-product-name"],sortFields:{"a-z":"name:asc","z-a":"name:desc",recommended:"sort-order:asc",featured:"featured:desc"},relatedItems:{enabled:!0,relationField:"variants"},relatedItemFields:["colors","color","size","finish"],customFilters:{"application-slugs":{type:"ilike"},material:{type:"exact"},featured:{type:"boolean"},thickness:{type:"numeric"},color:{type:"exact"},colors:{type:"exact"},size:{type:"array_contains"},finish:{type:"array_contains"}}})),`${this.baseUrl}?${t.toString()}`}renderItems(t){this.productContainer.innerHTML="";const e=document.createDocumentFragment();t.forEach(t=>{const i=this.createProductElement(t);i.style.opacity="0",e.appendChild(i)}),this.productContainer.appendChild(e),this.initImageHover(),this.animateItemsIn(),this.updateProductImages(),this.updateProductLinks()}appendItems(t){const e=document.createDocumentFragment();t.forEach(t=>{const i=this.createProductElement(t);i.style.opacity="0",e.appendChild(i)}),this.productContainer.appendChild(e),this.initImageHover();Array.from(this.productContainer.children).slice(-t.length).forEach((t,e)=>{setTimeout(()=>{t.style.transition="opacity 0.4s ease-out, transform 0.4s ease-out",t.style.opacity="1"},20*e)}),setTimeout(()=>{this.updateProductImages(),this.updateProductLinks()},20)}createProductElement(t){const e=t.name||t["actual-product-name"]||"Untitled",i=t.image?.url||null,r=t.slug||t.webflow_item_id||"",a=`/collections/${r}`,s=document.createElement("div");return s.setAttribute("role","listitem"),s.className="w-dyn-item",s.style.opacity="1",s.innerHTML=`\n        <div class="collection_grid-item" data-base-url="${a}" style="opacity: 1; view-transition-name: ${r};" data-hover-initialized="false">\n          <a href="${a}" class="collection_image-cover" style="display: block; color: inherit; text-decoration: none;">\n            <img src="https://cdn.prod.website-files.com/plugins/Basic/assets/placeholder.60f9b1840c.svg" loading="lazy" alt="" class="thumbnail-cover-img overlay-1">\n            <img src="https://cdn.prod.website-files.com/plugins/Basic/assets/placeholder.60f9b1840c.svg" loading="lazy" alt="" class="thumbnail-cover-img overlay-2">\n            ${this.createProgressiveBlurHTML(i,e)}\n          </a>\n          <div class="gradient-cover"></div>\n          <div class="collection-overlay">\n            <a href="${a}" class="collection_details" style="display: block; text-decoration: none;">\n              <div class="truncate">${e}</div>\n            </a>\n            ${this.createProductMetaHTML(t)}\n            ${this.createVariantThumbnailsHTML(t.related_items,a)}\n          </div>\n        </div>\n      `,s}createProgressiveBlurHTML(t,e){const i=t||"https://cdn.prod.website-files.com/plugins/Basic/assets/placeholder.60f9b1840c.svg",r=e||"product-image";return`\n        <div class="progressive-img-blur w-embed">\n          <div class="blur-img">\n            <div class="progressive-blur" style="--bg: url('${i}');" data-original-bg="${i}">\n              <div class="blur"></div>\n              <div class="blur"></div>\n              <div class="blur"></div>\n              <div class="blur"></div>\n            </div>\n            <img src="${i}" alt="${r}" data-original-src="${i}" data-original-alt="${r}">\n          </div>\n          <style>\n            .blur-img { position: absolute; inset: 0; overflow: hidden; border-radius: 0px; width: 100%; height: 100%; z-index: 0; transition: opacity 0.2s; }\n            .blur-img.top { z-index: 1; }\n            .blur-img img { width: 100%; height: 100%; object-fit: cover; transform: scale(1.06); }\n            .progressive-blur { position: absolute; z-index: 6; width: 100%; height: 100%; pointer-events: none; inset: auto 0 0 0; transform: scale(1.06); }\n            .blur { background: var(--bg); background-size: cover; position: absolute; background-position: center center; inset: 0; }\n            .progressive-blur>div:nth-child(1) { filter: blur(2px); mask-image: linear-gradient(to bottom, rgba(0,0,0,0) 70%, rgba(0,0,0,1) 76%, rgba(0,0,0,1) 82%, rgba(0,0,0,0) 88%); -webkit-mask-image: linear-gradient(to bottom, rgba(0,0,0,0) 70%, rgba(0,0,0,1) 76%, rgba(0,0,0,1) 82%, rgba(0,0,0,0) 88%); z-index: 1; }\n            .progressive-blur>div:nth-child(2) { filter: blur(4px); mask-image: linear-gradient(to bottom, rgba(0,0,0,0) 76%, rgba(0,0,0,1) 82%, rgba(0,0,0,1) 88%, rgba(0,0,0,0) 94%); -webkit-mask-image: linear-gradient(to bottom, rgba(0,0,0,0) 76%, rgba(0,0,0,1) 82%, rgba(0,0,0,1) 88%, rgba(0,0,0,0) 94%); z-index: 2; }\n            .progressive-blur>div:nth-child(3) { filter: blur(8px); mask-image: linear-gradient(to bottom, rgba(0,0,0,0) 82%, rgba(0,0,0,1) 88%, rgba(0,0,0,1) 94%, rgba(0,0,0,0) 100%); -webkit-mask-image: linear-gradient(to bottom, rgba(0,0,0,0) 82%, rgba(0,0,0,1) 88%, rgba(0,0,0,1) 94%, rgba(0,0,0,0) 100%); z-index: 3; }\n            .progressive-blur>div:nth-child(4) { filter: blur(16px); mask-image: linear-gradient(to bottom, rgba(0,0,0,0) 88%, rgba(0,0,0,1) 94%, rgba(0,0,0,1) 100%); -webkit-mask-image: linear-gradient(to bottom, rgba(0,0,0,0) 88%, rgba(0,0,0,1) 94%, rgba(0,0,0,1) 100%); z-index: 4; }\n            .progressive-blur>div:nth-child(5) { filter: blur(32px); mask-image: linear-gradient(to bottom, rgba(0,0,0,0) 94%, rgba(0,0,0,1) 100%); -webkit-mask-image: linear-gradient(to bottom, rgba(0,0,0,0) 94%, rgba(0,0,0,1) 100%); z-index: 5; }\n          </style>\n        </div>\n      `}createProductMetaHTML(t){return`\n        <div data-thickness="${t.thickness||""}" data-applications="${t["application-slugs"]||""}" data-material="${t.material||""}" class="product-meta">\n          ${t.featured||!1?'<div class="is-featured-flag"></div>':""}\n        </div>\n      `}createVariantThumbnailsHTML(t,e){if(!t||0===t.length)return'\n          <div class="collection-list-wrapper w-dyn-list">\n            <div role="list" class="variant_thumbnail-list w-dyn-items"></div>\n          </div>\n        ';return`\n        <div class="collection-list-wrapper w-dyn-list">\n          <div role="list" class="variant_thumbnail-list w-dyn-items">\n            ${t.map(t=>{const i=t["image-3"]?.url||"https://cdn.prod.website-files.com/plugins/Basic/assets/placeholder.60f9b1840c.svg",r=t["finish-slugs"]||"",a=this.extractColorName(t.color,t.slug),s=t["size-slugs"]||"",n=t.name||t.slug||t.webflow_item_id||"",o=t.slug||t.webflow_item_id||"";return`\n            <div role="listitem" class="w-dyn-item">\n              <a href="${o?`${e}?variant=${o}`:e}" class="variant-thumb-link" style="display: block; line-height: 0;">\n                <img src="${i}" loading="lazy" alt="${n}" class="variant-thumb" style="cursor: pointer;">\n              </a>\n              <div data-finishes="${r}" data-name="${n}" data-slug="${o}" data-color="${a}" data-sizes="${s}" class="variant-meta"></div>\n            </div>\n          `}).join("")}\n          </div>\n        </div>\n      `}extractColorName(t,e){const i={blue:"blue",green:"green",black:"black",white:"white",grey:"grey",gray:"grey"},r=(e||"").toLowerCase();for(const[t,e]of Object.entries(i))if(r.includes(t))return e;return t||""}normalizeFilterKey(t){const e=(t||"").toString().trim().toLowerCase().replace(/\s+/g,"-");return"color"===e||"colors"===e?"colors":"size"===e||"sizes"===e?"size":"finish"===e||"finishes"===e?"finish":"material"===e||"materials"===e?"material":"application"===e||"applications"===e?"application":e}updateFilters(){this.activeFilters={};this.filterForm.querySelectorAll('input[type="checkbox"]:checked').forEach(t=>{const e=t.name,i=t.value,r=this.normalizeFilterKey(e);this.activeFilters[r]||(this.activeFilters[r]=[]),this.activeFilters[r].push(i)}),this.updateFilterChips()}async applyFilters(){await this.loadInitialData(),this.updateURLParams(),this.updateProductLinks()}updateProductImages(){const t=this.activeFilters.colors||this.activeFilters.color;document.querySelectorAll(".collection_grid-item").forEach((e,i)=>{setTimeout(()=>{if(t&&1===t.length){const i=this.getVariantImageForColor(e,t[0]);i&&this.showImageOverlay(e,i.src,i.alt,!0)}else this.restoreOriginalImage(e)},1*i)})}getVariantImageForColor(t,e){const i=t.querySelectorAll(".variant-thumb"),r=e.toLowerCase();for(const t of i){const e=t.nextElementSibling;if(!e||!e.classList.contains("variant-meta"))continue;const i=e.getAttribute("data-color");if(!i)continue;if(i.split(",").map(t=>t.trim().toLowerCase()).includes(r))return{src:t.src,alt:t.alt}}return null}createBlurImageOverlay(t,e){return`\n        <div class="blur-img top" style="opacity: 0; transition: opacity 0.3s ease;">\n          <div class="progressive-blur" style="--bg: url('${t}');">\n            <div class="blur"></div>\n            <div class="blur"></div>\n            <div class="blur"></div>\n            <div class="blur"></div>\n          </div>\n          <img src="${t}" alt="${e}">\n        </div>\n      `}showImageOverlay(t,e,i,r=!1){const a=t.querySelector(".progressive-img-blur");if(!a)return;const s=a.querySelector(".blur-img.top");s&&(s.style.opacity="0",setTimeout(()=>s.remove(),10)),setTimeout(()=>{const s=this.createBlurImageOverlay(e,i),n=a.querySelector(".blur-img:not(.top)");if(!n)return;n.insertAdjacentHTML("afterend",s);const o=a.querySelector(".blur-img.top");o&&requestAnimationFrame(()=>{o.style.opacity="1",t.dataset.hasOverlay="true",r&&(o.dataset.permanent="true",setTimeout(()=>{this.replaceMainImage(t,e,i)},300))})},r?0:50)}hideImageOverlay(t){const e=t.querySelector(".progressive-img-blur");if(!e)return;const i=e.querySelector(".blur-img.top");i&&!i.dataset.permanent&&(i.style.opacity="0",setTimeout(()=>{i.parentNode&&(i.remove(),t.removeAttribute("data-has-overlay"))},300))}replaceMainImage(t,e,i){const r=t.querySelector(".blur-img:not(.top) img"),a=t.querySelector(".blur-img:not(.top) .progressive-blur");r&&(r.src=e,r.alt=i),a&&a.style.setProperty("--bg",`url('${e}')`)}restoreOriginalImage(t){const e=t.querySelector(".blur-img:not(.top) img"),i=t.querySelector(".blur-img:not(.top) .progressive-blur"),r=t.querySelector(".blur-img.top[data-permanent]");if(!e||!i)return;const a=e.dataset.originalSrc,s=e.dataset.originalAlt,n=i.dataset.originalBg;a&&n&&(r&&(r.style.opacity="0",setTimeout(()=>{r.parentNode&&(r.remove(),t.removeAttribute("data-has-overlay"))},300)),setTimeout(()=>{this.replaceMainImage(t,a,s)},r?300:0))}animateItemsIn(){this.productContainer.querySelectorAll(".w-dyn-item").forEach((t,e)=>{setTimeout(()=>{t.style.transition="opacity 0.4s ease-out, transform 0.4s ease-out",t.style.opacity="1",t.style.transform="translateY(0)"},20*e)})}initImageHover(){document.querySelectorAll(".collection_grid-item").forEach(t=>{if("true"===t.dataset.hoverInitialized)return;const e=t.querySelectorAll(".variant-thumb"),i=t.querySelector(".variant_thumbnail-list");if(0===e.length)return;let r,a=!1;i&&(i.addEventListener("mouseenter",()=>{a=!0,r&&(clearTimeout(r),r=null)}),i.addEventListener("mouseleave",()=>{a=!1,r=setTimeout(()=>{this.hideImageOverlay(t)},200)})),e.forEach(e=>{e.addEventListener("mouseenter",()=>{r&&(clearTimeout(r),r=null);t.querySelector(".blur-img.top[data-permanent]")||this.showImageOverlay(t,e.src,e.alt,!1)}),e.addEventListener("mouseleave",()=>{a||(r=setTimeout(()=>{this.hideImageOverlay(t)},200))})}),t.dataset.hoverInitialized="true"})}initProductNavigation(){}getVariantsForColor(t,e){const i=t.querySelectorAll(".variant-thumb"),r=[];return i.forEach(t=>{const i=t.nextElementSibling;if(!i||!i.classList.contains("variant-meta"))return;const a=i.getAttribute("data-color"),s=i.getAttribute("data-slug");if(!a||!s)return;a.split(",").map(t=>t.trim().toLowerCase()).includes(e)&&r.push(s)}),r}updateProductLinks(){const t=this.activeFilters.colors||this.activeFilters.color;document.querySelectorAll(".collection_grid-item").forEach(e=>{const i=e.dataset.baseUrl;if(!i)return;let r=i;if(t&&1===t.length){const a=this.getVariantsForColor(e,t[0].toLowerCase());1===a.length&&(r=`${i}?variant=${a[0]}`)}const a=e.querySelector(".collection_image-cover"),s=e.querySelector(".collection_details");a&&"A"===a.tagName&&(a.href=r),s&&"A"===s.tagName&&(s.href=r)})}initNiceSelect(){if(this.sortDropdown&&"undefined"!=typeof NiceSelect)try{this.niceSelect=NiceSelect.bind(this.sortDropdown,{searchable:!1,placeholder:"Select...",searchtext:"Search",selectedtext:"geselecteerd"})}catch(t){console.error("Failed to initialize Nice Select 2:",t)}}updateNiceSelect(t){if(this.sortDropdown)try{this.sortDropdown.value=t,this.niceSelect&&this.niceSelect.update()}catch(t){console.error("Failed to update Nice Select:",t)}}initEventListeners(){this.filterForm&&this.filterForm.addEventListener("change",async t=>{"checkbox"===t.target.type&&(this.updateFilters(),await this.applyFilters())},{signal:this._ac.signal}),this.sortDropdown&&this.sortDropdown.addEventListener("change",async t=>{this.currentSort=t.target.value,await this.applyFilters()},{signal:this._ac.signal}),this.clearButton&&this.clearButton.addEventListener("click",async t=>{t.preventDefault(),await this.clearAllFilters()},{signal:this._ac.signal}),this.initFilterChipEvents()}initInfiniteScroll(){this._observer=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&this.hasMorePages&&!this.isLoading&&(this.currentPage++,this.fetchItems(!0))})},{rootMargin:"100px",threshold:.1}),this._sentinel=document.createElement("div"),this._sentinel.style.height="1px",this._sentinel.style.position="absolute",this._sentinel.style.bottom="100px",this._sentinel.style.width="100%",this.productContainer&&this.productContainer.parentNode&&(this.productContainer.parentNode.appendChild(this._sentinel),this._observer.observe(this._sentinel))}updatePagination(t){t&&(this.totalItems=t.total||0,this.hasMorePages=t.hasMore||!1)}updateURLParams(){const t=new URLSearchParams;Object.entries(this.activeFilters).forEach(([e,i])=>{i.length>0&&t.set(e,i.join(","))}),"recommended"!==this.currentSort&&t.set("sort",this.currentSort);const e=t.toString()?`${window.location.pathname}?${t.toString()}`:window.location.pathname;window.history.replaceState({},"",e)}loadFromURLParams(){const t=new URLSearchParams(window.location.search),e=t.get("sort");e&&(this.currentSort=e,this.updateNiceSelect(e));const i={color:["color","colors","Color","Colors"],colors:["colors","color","Colors","Color"],size:["size","sizes","Size","Sizes"],sizes:["sizes","size","Sizes","Size"],finish:["finish","finishes","Finish","Finishes"],finishes:["finishes","finish","Finishes","Finish"],application:["application","applications","Application","Applications"],applications:["applications","application","Applications","Application"],"application-slugs":["application","applications","Application","Applications"],material:["material","materials","Material","Materials","material-type","materialtype"],materials:["materials","material","Materials","Material","material-type","materialtype"],thickness:["thickness","Thickness"]};let r=!1;for(const[e,a]of t.entries()){if(["sort","page","limit","config","collection_id"].includes(e))continue;if(!a)continue;const t=a.split(","),s=i[e]||[e];t.forEach(t=>{let e=null;for(const i of s)if(e=this.filterForm?.querySelector(`input[name="${i}"][value="${t}"]`),e)break;e&&(e.checked=!0,r=!0)})}r?this.updateFilters():this.updateFilterChips()}updateResultsCounter(t){this.resultsCounter&&(this.resultsCounter.textContent=t)}updateClearButton(){if(this.clearButton){const t=Object.keys(this.activeFilters).length>0;this.clearButton.style.opacity=t?"1":"0.5",this.clearButton.disabled=!t}}async clearAllFilters(){this.filterForm.querySelectorAll('input[type="checkbox"]:checked').forEach(t=>t.checked=!1),this.currentSort="recommended",this.updateNiceSelect("recommended"),this.updateFilters(),await this.applyFilters()}clearProductContainer(){this.productContainer&&(this.productContainer.innerHTML="")}updateFilterChips(){const t=document.querySelector(".filter-chip-group");t&&(t.innerHTML="",Object.entries(this.activeFilters).forEach(([e,i])=>{i.forEach(i=>{const r=document.createElement("div");r.className="filter-chip",r.setAttribute("data-chip-value",i),r.setAttribute("data-chip-filter",e);const a=this.getDisplayValueForFilter(i,e);r.innerHTML=`\n              <div class="remove-btn"><div class="text-block-4">x</div></div>\n              <div>${a}</div>\n            `,t.appendChild(r)})}))}getDisplayValueForFilter(t){return t.charAt(0).toUpperCase()+t.slice(1)}initFilterChipEvents(){document.addEventListener("click",async t=>{const e=t.target.closest(".remove-btn");if(!e)return;const i=e.closest(".filter-chip");if(!i)return;const r=i.getAttribute("data-chip-filter"),a=i.getAttribute("data-chip-value");await this.removeFilter(r,a)},{signal:this._ac.signal})}async removeFilter(t,e){const i={colors:["color","colors","Color","Colors"],color:["color","colors","Color","Colors"],size:["size","sizes","Size","Sizes"],finish:["finish","finishes","Finish","Finishes"],application:["application","applications","Application","Applications"],material:["material","materials","Material","Materials","material-type","materialtype"],thickness:["thickness","Thickness"]}[t]||[t];let r=null;for(const t of i)if(r=this.filterForm?.querySelector(`input[name="${t}"][value="${e}"]`),r)break;r&&(r.checked=!1,this.updateFilters(),await this.applyFilters())}handleError(t){console.error("Filter error:",t),this.productContainer&&(this.productContainer.innerHTML=`\n          <div class="error-message" style="grid-column:1 / -1; text-align:center; padding:2rem; background:#fee; border:1px solid #fcc; border-radius:8px; color:#c33;">\n            <h3>Error loading products</h3>\n            <p>${t.message}</p>\n            <button onclick="window.location.reload()" style="margin-top:1rem; padding:0.5rem 1rem; background:#c33; color:white; border:none; border-radius:4px; cursor:pointer;">Reload Page</button>\n          </div>\n        `)}destroy(){try{this._ac?.abort?.()}catch(t){}try{this._observer?.disconnect?.()}catch(t){}try{this._sentinel?.remove?.()}catch(t){}}};window.productFilter=n,window.InfiniteScrollProductFilter=n,a("collections",{destroy:()=>{try{n.destroy()}catch(t){}}})}async function u(t){await i("https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0/dist/carousel/carousel.css"),await i("https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0/dist/fancybox/fancybox.css"),window.Carousel||await e("https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0/dist/carousel/carousel.umd.js"),window.Fancybox||await e("https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0/dist/fancybox/fancybox.umd.js"),window.Arrows||await e("https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0/dist/carousel/carousel.arrows.umd.js"),window.Dots||await e("https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0/dist/carousel/carousel.dots.umd.js"),window.Thumbs||await e("https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0/dist/carousel/carousel.thumbs.umd.js");const r=document.getElementById("product-carousel"),s=document.querySelector(".product-image"),n=document.querySelector("[data-product-name]");if(!r||!s||!n)return void a("product",{destroy:()=>{}});const o=new class{constructor(){this.slides=[],this.variants=[],this.selectedVariant=null,this.carousel=null,this.fancybox=null,this.initialSlideIndex=0,this.isInitialLoad=!0,this._ac=new AbortController,this.init()}init(){this.extractProductData(),this.determineInitialSlide(),this.buildCarousel(),this.buildVariantButtons(),this.setupFancybox();const t=document.querySelector(".variant-info");t&&(t.style.display="none"),this.handleInitialVariant()}extractProductData(){const t=document.querySelector(".product-image"),e=document.querySelector("[data-product-name]").textContent;this.slides=[{type:"main",src:t.src,alt:`${e} - Main Image`,variantSlug:null,w:1200,h:800}],this.variants=[];document.querySelectorAll(".variants-list .w-dyn-item").forEach(t=>{const i=t.children[0],r=t.querySelector("img"),a=t.querySelector(".product-variant-meta"),s={name:i.textContent,slug:a.dataset.variantSlug,image:r.src,sizes:a.dataset.sizes.split(",").map(t=>t.trim()),finishes:a.dataset.finishes.split(",").map(t=>t.trim())};this.variants.push(s),this.slides.push({type:"variant",src:s.image,alt:`${e} - ${s.name}`,variantSlug:s.slug,w:1200,h:800})})}determineInitialSlide(){const t=new URLSearchParams(window.location.search).get("variant");if(this.initialSlideIndex=0,t&&this.variants.some(e=>e.slug===t)){const e=this.slides.findIndex(e=>e.variantSlug===t);if(-1!==e)return this.initialSlideIndex=e,void(this.selectedVariant=t)}this.variants.length>0?this.selectedVariant=this.variants[0].slug:this.selectedVariant=null}buildCarousel(){const t=document.getElementById("product-carousel");if(t){t.innerHTML="",this.slides.forEach(e=>{const i=document.createElement("div");i.className="f-carousel__slide";const r=document.createElement("img");r.src=e.src,r.alt=e.alt,r.dataset.fancybox="gallery",r.dataset.src=e.src,r.dataset.caption=e.alt,r.className="carousel-image",r.style.cursor="pointer",i.appendChild(r),t.appendChild(i)});try{this.carousel=Carousel(t,{infinite:!0,center:!0,fill:!0,dragFree:!1,initialPage:this.initialSlideIndex},{Arrows:Arrows,Thumbs:Thumbs}).init()}catch(t){console.error("Failed to initialize Carousel:",t)}}}setupFancybox(){Fancybox.bind('[data-fancybox="gallery"]',{Carousel:{Toolbar:{display:{right:["zoomIn","zoomOut","thumbs","close"]}}}})}buildVariantButtons(){const t=document.querySelector(".variant-buttons");t&&(t.innerHTML="",this.variants.forEach(e=>{const i=document.createElement("button");i.className="variant-btn",i.dataset.variantSlug=e.slug,i.innerHTML=`\n          <img src="${e.image}" alt="${e.name}" class="variant-btn-image">\n          <span>${this.slugToName(e.name)}</span>\n        `,i.addEventListener("click",()=>{this.isInitialLoad=!1,this.selectVariant(e.slug,!0)},{signal:this._ac.signal}),t.appendChild(i)}))}handleInitialVariant(){if(this.selectedVariant){new URLSearchParams(window.location.search).get("variant")===this.selectedVariant?this.selectVariant(this.selectedVariant,!0,!1):this.selectVariant(this.selectedVariant,!1,!1)}setTimeout(()=>{this.isInitialLoad=!1},100)}selectVariant(t,e=!0,i=!0){if(this.selectedVariant=t,document.querySelectorAll(".variant-btn").forEach(e=>{e.classList.toggle("selected",e.dataset.variantSlug===t)}),e&&this.carousel){const e=this.slides.findIndex(e=>e.variantSlug===t);if(-1!==e)try{"function"==typeof this.carousel.slideTo?this.carousel.slideTo(e):"function"==typeof this.carousel.goTo?this.carousel.goTo(e):this.carousel.page=e}catch(t){console.error("Error navigating to slide:",t)}}this.displayVariantInfo(t),i&&this.updateURLParams()}displayVariantInfo(t){const e=document.querySelector(".variant-info");if(!t)return void(e&&(e.style.display="none"));const i=this.variants.find(e=>e.slug===t);if(!i)return void(e&&(e.style.display="none"));const r=document.querySelector(".variant-name"),a=document.querySelector(".sizes-list"),s=document.querySelector(".finishes-list");e&&r&&a&&s&&(r.textContent=this.slugToName(i.name),a.innerHTML="",s.innerHTML="",i.sizes.forEach(t=>{const e=document.createElement("div");e.className="size-item",e.textContent=this.slugToName(t),a.appendChild(e)}),i.finishes.forEach(t=>{const e=document.createElement("div");e.className="finish-item",e.textContent=this.slugToName(t),s.appendChild(e)}),e.style.display="block")}slugToName(t){return t.split(/[-_\s]+/).map(t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join(" ")}updateURLParams(){const t=new URL(window.location);this.selectedVariant?t.searchParams.set("variant",this.selectedVariant):t.searchParams.delete("variant"),window.history.replaceState(null,"",t)}destroy(){try{this._ac?.abort?.()}catch(t){}try{this.carousel?.destroy?.()}catch(t){}try{window.Fancybox&&Fancybox.destroy&&Fancybox.destroy()}catch(t){}}};a("product",{destroy:()=>o.destroy()})}const h='[data-navigation] a[href]:not([target="_blank"]):not([data-no-barba])';function p(){return document.querySelector("[data-navigation-status]")}function m(){const t=p();t&&t.setAttribute("data-navigation-status","not-active")}function g(){const t=p();if(!t)return;const e="active"===t.getAttribute("data-navigation-status");t.setAttribute("data-navigation-status",e?"not-active":"active")}function f(t=location.pathname){document.querySelectorAll(h).forEach(e=>{const i=e.getAttribute("href")||"",r=new URL(i,location.origin).pathname===t;e.classList.toggle("w--current",r),r?e.setAttribute("aria-current","page"):e.removeAttribute("aria-current")})}function y(){y._ac?.abort?.();const t=new AbortController;y._ac=t,document.querySelectorAll('[data-navigation-toggle="toggle"]').forEach(e=>{e.addEventListener("click",g,{signal:t.signal})}),document.querySelectorAll('[data-navigation-toggle="close"]').forEach(e=>{e.addEventListener("click",m,{signal:t.signal})}),document.addEventListener("keydown",t=>{"Escape"===t.key&&m()},{signal:t.signal}),document.querySelectorAll(h).forEach(e=>{e.addEventListener("click",()=>m(),{signal:t.signal})})}function b(){document.querySelectorAll("[data-button-animate-chars]").forEach(t=>{const e=t.textContent;t.innerHTML="",[...e].forEach((e,i)=>{const r=document.createElement("span");r.textContent=e,r.style.transitionDelay=.015*i+"s"," "===e&&(r.style.whiteSpace="pre"),t.appendChild(r)})})}const v=()=>{if(window.Webflow&&window.Webflow.require)try{window.Webflow.destroy(),window.Webflow.ready(),window.Webflow.require("ix2").init()}catch(t){}};function w(){if(y(),f(),!window.barba||!barba.init)return void console.error("Barba not found. Include @barba/core before this script.");window.barbaPrefetch&&barba.use(barbaPrefetch),"scrollRestoration"in history&&(history.scrollRestoration="manual"),barba.init({prevent:({el:t})=>t?.hasAttribute?.("data-no-barba"),transitions:[{name:"fade",leave({current:t}){if(window.gsap)return gsap.to(t.container,{opacity:0,duration:.2,ease:"power1.out"})},enter({next:t}){if(window.gsap)return t.container.style.opacity=0,gsap.to(t.container,{opacity:1,duration:.2,ease:"power1.out"})}}],views:[{namespace:"home",beforeLeave(){s("home")?.destroy?.(),n("home")},async afterEnter(){await l()}},{namespace:"collections",beforeLeave(){!function(){const t=document.querySelector(".product-grid"),e=location.href;if(!t)return;const i=window.productFilter?{activeFilters:window.productFilter.activeFilters,currentSort:window.productFilter.currentSort,currentPage:window.productFilter.currentPage,hasMorePages:window.productFilter.hasMorePages,totalItems:window.productFilter.totalItems}:null;o.set(e,{html:t.innerHTML,state:i,scrollY:window.scrollY})}(),s("collections")?.destroy?.(),n("collections")},async afterEnter(t){"back"===t.trigger&&function(){const t=location.href,e=o.get(t);if(!e)return!1;const i=document.querySelector(".product-grid"),r=document.getElementById("filters");if(!i||!r)return!1;if(i.innerHTML=e.html,!window.InfiniteScrollProductFilter)return!1;const a=window.InfiniteScrollProductFilter.constructor,s=Object.create(a.prototype);return s.productContainer=i,s.filterForm=r,s.sortDropdown=document.getElementById("sort-select"),s.resultsCounter=document.querySelector("[data-results-count]"),s.clearButton=document.querySelector(".button.alt"),s.collectionId="c09bba8e-4a81-49c2-b722-f1fa46c75861",s.baseUrl="https://wmkcwljhyweqzjivbupx.supabase.co/functions/v1/generic-collection-filter",s.itemsPerPage=30,s.isLoading=!1,s.niceSelect=null,s._ac=new AbortController,s._observer=null,s._sentinel=null,s._respCache=new Map,s.activeFilters=e.state?.activeFilters||{},s.currentSort=e.state?.currentSort||"recommended",s.currentPage=e.state?.currentPage||1,s.hasMorePages=!!e.state?.hasMorePages,s.totalItems=e.state?.totalItems||0,window.productFilter&&(s.initImageHover=window.productFilter.initImageHover.bind(s),s.updateProductImages=window.productFilter.updateProductImages.bind(s),s.updateProductLinks=window.productFilter.updateProductLinks.bind(s),s.updateResultsCounter=window.productFilter.updateResultsCounter.bind(s),s.initInfiniteScroll=window.productFilter.initInfiniteScroll.bind(s),s.initImageHover(),s.updateProductImages(),s.updateProductLinks(),s.updateResultsCounter(s.totalItems),s.initInfiniteScroll()),window.productFilter=s,!0}()?v():await d()}},{namespace:"product",beforeLeave(){s("product")?.destroy?.(),n("product")},async afterEnter(){await u()}}]}),barba.hooks.before(()=>{m()}),barba.hooks.after(t=>{if("back"===t.trigger||"forward"===t.trigger){const t=barba.history.current?.scroll?.y??0;window.scrollTo(0,t)}else window.scrollTo({top:0,behavior:"auto"})}),barba.hooks.afterEnter(t=>{f(t?.next?.url?.path||location.pathname),v(),b()}),b(),v();const t=document.querySelector('[data-barba="container"]')?.getAttribute("data-barba-namespace");"home"===t?l():"collections"===t?d():"product"===t&&u()}document.addEventListener("DOMContentLoaded",()=>{w()})}();
