!function(){"use strict";const e='[data-navigation] a[href]:not([target="_blank"]):not([data-no-barba])';function t(){return document.querySelector("[data-navigation-status]")}function o(e=!1){const o=t();o&&o.setAttribute("data-navigation-status","not-active")}function s(){const e=t();if(!e)return;const o="active"===e.getAttribute("data-navigation-status");e.setAttribute("data-navigation-status",o?"not-active":"active")}function n(t=location.pathname){let o=document.querySelectorAll(e);0===o.length&&(o=document.querySelectorAll('.hamburger-nav a[href]:not([target="_blank"])')),0===o.length&&(o=document.querySelectorAll('nav a[href]:not([target="_blank"]):not([data-taxi-ignore])')),o.forEach(e=>{const o=e.getAttribute("href")||"";try{const s=new URL(o,location.origin).pathname===t;e.classList.toggle("w--current",s),s?e.setAttribute("aria-current","page"):e.removeAttribute("aria-current")}catch(e){}})}function i(){i._ac?.abort?.();const t=new AbortController;i._ac=t,document.querySelectorAll('[data-navigation-toggle="toggle"]').forEach(e=>{e.addEventListener("click",s,{signal:t.signal})}),document.querySelectorAll('[data-navigation-toggle="close"]').forEach(e=>{e.addEventListener("click",o,{signal:t.signal})}),document.addEventListener("keydown",e=>{"Escape"===e.key&&o()},{signal:t.signal}),document.querySelectorAll(e).forEach(e=>{e.addEventListener("click",()=>o(!0),{signal:t.signal})})}function a(){return window.taxi?class extends window.taxi.Renderer{initialLoad(){this.onEnter(),this.onEnterCompleted()}onEnter(){}onEnterCompleted(){}onLeave(){}onLeaveCompleted(){}}:(console.error("taxi not loaded!"),class{})}const r=new Set,l=(e,t={})=>r.has(e)?Promise.resolve():new Promise((o,s)=>{const n=document.createElement("script");n.src=e,n.async=!0,Object.entries(t).forEach(([e,t])=>n.setAttribute(e,t)),n.onload=()=>{r.add(e),o()},n.onerror=s,document.head.appendChild(n)}),c=e=>r.has(e)?Promise.resolve():new Promise((t,o)=>{const s=document.createElement("link");s.rel="stylesheet",s.href=e,s.onload=()=>{r.add(e),t()},s.onerror=o,document.head.appendChild(s)}),d=new Map,u=(e,t)=>d.set(e,t),h=e=>d.get(e)||{};async function g(e){window.gsap||await l("https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"),await c("https://cdn.jsdelivr.net/npm/swiper@12/swiper-bundle.min.css"),window.Swiper||await l("https://cdn.jsdelivr.net/npm/swiper@12/swiper-bundle.min.js");const t=document.querySelector(".swiper");if(!t)return void u("home",{destroy:()=>{}});const o=window.matchMedia("(prefers-reduced-motion: reduce)").matches,s=o?0:1.45;let n=null,i=null,a=null,r=0,d=null;if(window.SplitText&&window.gsap&&gsap.registerPlugin)try{gsap.registerPlugin(SplitText)}catch(e){}function h(e){if(!e||!window.SplitText)return null;if(e.__split)return e.__split;const t=e.querySelector(".slider-product-name");if(!t)return null;const o=new SplitText(t,{type:"chars"});return e.__split=o,gsap.set(o.chars,{yPercent:120,rotate:6,opacity:0,transformOrigin:"0% 100%",willChange:"transform, opacity"}),o}function g(e,t){const o=e.slides[t].swiperSlideOffset||0;return e.rtlTranslate?o:-o}function m(e,t){o||(e.setTranslate(t),e.slides.forEach(e=>{const t=e.querySelector(".slider-img");if(!t)return;const o="number"==typeof e.progress?e.progress:0;gsap.set(t,{xPercent:28*o})}))}function p(){a&&(a.kill(),a=null)}function w(e){p(),o||(a=gsap.delayedCall(4.2,e))}function f(e,t="next"){if(!n)return;p(),i&&(i.kill(),i=null);const o=function(e){let t=-1;return e.slides.forEach(e=>{const o=parseInt(e.getAttribute("data-swiper-slide-index")||"0",10);!Number.isNaN(o)&&o>t&&(t=o)}),t+1}(e),a=e.activeIndex,l=e.slides[a];let c;c="next"===t?(e.realIndex+1)%o:"prev"===t?(e.realIndex-1+o)%o:"number"==typeof t?(t%o+o)%o:(e.realIndex+1)%o,e.updateSlides(),e.updateSlidesOffset();const d=function(e,t,o){let s=-1,n=1/0;return e.slides.forEach((i,a)=>{if(parseInt(i.getAttribute("data-swiper-slide-index")||"-1",10)!==t)return;const r=g(e,a),l=Math.abs(r-o);l<n&&(n=l,s=a)}),s}(e,c,r);e.slideTo(d,0,!1),e.updateSlides(),e.updateSlidesOffset();const u=e.activeIndex,y=e.slides[u],v=r;let S=g(e,u);if(v===S){const t=e.rtlTranslate?-1:1;S-=t*e.width}i=gsap.timeline({onUpdate:()=>{const t=gsap.getProperty(n,"x");m(e,t)},onComplete:()=>{r=S,w(()=>f(e,"next"))}}),function(e){const t=h(e);t&&(gsap.killTweensOf(t.chars),gsap.to(t.chars,{yPercent:-120,rotate:-4,opacity:0,duration:.5,ease:"power2.in",stagger:{each:.015,from:"end"},onComplete:()=>{gsap.set(t.chars,{yPercent:120,rotate:6,opacity:0})}}))}(l),function(e){const t=h(e);t&&(gsap.killTweensOf(t.chars),gsap.set(t.chars,{yPercent:120,rotate:6,opacity:0}))}(y),i.fromTo(n,{x:v},{x:S,duration:s,ease:"power4.inOut"},0),i.add(()=>function(e){const t=h(e);t&&(gsap.killTweensOf(t.chars),gsap.to(t.chars,{yPercent:0,rotate:0,opacity:1,duration:.9,ease:"power3.out",stagger:{each:.02,from:"start"}}))}(y),.3*s)}const y=new Swiper(".swiper",{loop:!0,slidesPerView:1,allowTouchMove:!1,speed:0,virtualTranslate:!0,watchSlidesProgress:!0,on:{init(e){n=e.el.querySelector(".swiper-wrapper"),e.slides.forEach(h),e.updateSlides(),e.updateSlidesOffset(),r=g(e,e.activeIndex),gsap.set(n,{x:r,willChange:"transform",force3D:!0}),m(e,r);(function(e){const s=document.querySelector('[data-taxi-view="home"]');if(s&&(window.gsap?gsap.set(s,{opacity:1}):s.style.opacity="1"),!window.gsap)return Promise.resolve();const n=gsap.timeline(),i=document.querySelector(".hero-heading");i&&n.fromTo(i,{opacity:0,scale:.8},{opacity:1,scale:1,duration:.85,ease:"expo.inOut",transformOrigin:"top left"},0);const a=document.querySelectorAll(".btn-group > *");a.length>0&&(gsap.set(a,{clearProps:"transform"}),gsap.set(a,{yPercent:102}),n.to(a,{yPercent:0,duration:.85,ease:"expo.inOut",stagger:.045},.09));const r=document.querySelector(".hero-cover");r&&n.fromTo(r,{width:"100%"},{width:"0%",duration:.85,ease:"expo.inOut"},.28);const l=document.querySelector(".sm-premium");if(l&&window.SplitText){gsap.set(l,{opacity:1});const e=new SplitText(l,{type:"chars"});gsap.set(e.chars,{opacity:0}),n.to(e.chars,{opacity:1,duration:1.05,ease:"power1.out",stagger:.017},.4)}if(t&&n.fromTo(t,{scale:1.1},{scale:1,duration:1.05,ease:"expo.out"},.42),e&&!o){const t=h(e.slides[e.activeIndex]);t&&n.to(t.chars,{yPercent:0,rotate:0,opacity:1,duration:.9,ease:"power3.out",stagger:{each:.02,from:"start"}},.8)}return n})(e).then(()=>{w(()=>f(e,"next"))})},resize(e){e.updateSlides(),e.updateSlidesOffset(),r=g(e,e.activeIndex),gsap.set(n,{x:r}),m(e,r)}}}),v=()=>{document.hidden?p():w(()=>f(y,"next"))};document.addEventListener("visibilitychange",v),u("home",{playExitAnimation:()=>(d=function(){const e=gsap.timeline(),o=document.querySelector(".sm-premium");if(o&&window.SplitText){const t=new SplitText(o,{type:"chars"});e.fromTo(t.chars,{opacity:1},{opacity:0,duration:.65,ease:"power1.out",stagger:.009},0)}const s=document.querySelector(".hero-heading");s&&e.fromTo(s,{opacity:1,scale:1},{opacity:0,scale:.8,duration:.8,ease:"expo.inOut",transformOrigin:"top left"},0);const n=document.querySelectorAll(".btn-group > *");n.length>0&&e.fromTo(n,{yPercent:0},{yPercent:102,duration:.8,ease:"expo.inOut",stagger:.045},.05);const i=document.querySelector(".hero-cover");return i&&e.fromTo(i,{width:"0%"},{width:"100%",duration:.8,ease:"expo.inOut"},.16),t&&e.fromTo(t,{scale:1},{scale:.5,duration:.8,ease:"expo.in"},.16),e}(),d),destroy:()=>{try{document.removeEventListener("visibilitychange",v)}catch(e){}try{p()}catch(e){}try{i?.kill?.()}catch(e){}try{y?.destroy?.(!0,!0)}catch(e){}try{enterAnimation?.kill?.()}catch(e){}try{d?.kill?.()}catch(e){}}})}class m{constructor(){this.allLoadedItems=[],this.totalItems=0,this.activeFilters={},this.currentSort="recommended",this.currentPage=1,this.itemsPerPage=10,this.hasMorePages=!0,this.clickedProductId=null,console.log("üìä CollectionState initialized")}getItems(){return this.allLoadedItems}getTotalItems(){return this.totalItems}getActiveFilters(){return this.activeFilters}getCurrentSort(){return this.currentSort}getCurrentPage(){return this.currentPage}hasFilters(){return Object.values(this.activeFilters).some(e=>Array.isArray(e)&&e.length>0)}setItems(e){this.allLoadedItems=[...e],console.log(`  üìä State: Set items to ${this.allLoadedItems.length}`)}appendItems(e){this.allLoadedItems.push(...e),console.log(`  üìä State: Appended ${e.length} items, total now ${this.allLoadedItems.length}`)}setTotalItems(e){this.totalItems=e}setActiveFilters(e){this.activeFilters={...e},console.log("  üìä State: Filters updated:",JSON.stringify(this.activeFilters))}setCurrentSort(e){this.currentSort=e,console.log(`  üìä State: Sort updated: ${e}`)}setCurrentPage(e){this.currentPage=e}incrementPage(){this.currentPage++}setHasMorePages(e){this.hasMorePages=e}setClickedProductId(e){this.clickedProductId=e}reset(){this.allLoadedItems=[],this.currentPage=1,this.hasMorePages=!0,console.log("  üìä State: Reset to initial state")}toJSON(){return{allLoadedItems:this.allLoadedItems,totalItems:this.totalItems,activeFilters:this.activeFilters,currentSort:this.currentSort,currentPage:this.currentPage,hasMorePages:this.hasMorePages,clickedProductId:this.clickedProductId}}fromJSON(e){e&&(this.allLoadedItems=e.allLoadedItems||[],this.totalItems=e.totalItems||0,this.activeFilters=e.activeFilters||{},this.currentSort=e.currentSort||"recommended",this.currentPage=e.currentPage||1,this.hasMorePages=void 0===e.hasMorePages||e.hasMorePages,this.clickedProductId=e.clickedProductId||null,console.log(`  üìä State: Restored from JSON - ${this.allLoadedItems.length} items`))}}class p{constructor(){this.cacheExpiration=3e5,console.log("üíæ CollectionCache initialized")}getCacheKey(){const e=new URLSearchParams(window.location.search);e.delete("page"),e.delete("limit"),e.delete("config"),e.delete("collection_id");return`collections_${Array.from(e.entries()).sort(([e],[t])=>e.localeCompare(t)).map(([e,t])=>`${e}=${t}`).join("&")||"default"}`}save(e){try{const t=this.getCacheKey(),o={...e.toJSON(),timestamp:Date.now()};return sessionStorage.setItem(t,JSON.stringify(o)),console.log(`  üíæ Saved to cache: "${t}"`),console.log(`     Items: ${o.allLoadedItems.length}/${o.totalItems}`),console.log("     Filters:",JSON.stringify(o.activeFilters)),!0}catch(e){return console.error("Failed to save to cache:",e),!1}}restore(e=!1){try{const t=this.getCacheKey();console.log(`  üîë Cache key: "${t}"`);const o=sessionStorage.getItem(t);if(!o)return console.log("  ‚ùå No cache found for this URL state"),null;const s=JSON.parse(o),n=Date.now()-s.timestamp;return console.log(`  üì¶ Cache found: age=${Math.round(n/1e3)}s, items=${s.allLoadedItems?.length||0}/${s.totalItems}`),n>this.cacheExpiration?(console.log("  ‚è∞ Cache expired (>5min)"),sessionStorage.removeItem(t),null):s.allLoadedItems&&0!==s.allLoadedItems.length?(e||(s.clickedProductId=null),console.log(`  ‚úÖ Restoring ${s.allLoadedItems.length}/${s.totalItems} items from cache`),s):(console.log("  ‚ö†Ô∏è Cache has no items"),null)}catch(e){console.error("Failed to restore from cache:",e);const t=this.getCacheKey();return sessionStorage.removeItem(t),null}}clear(){const e=this.getCacheKey();sessionStorage.removeItem(e),console.log(`  üóëÔ∏è Cleared cache: "${e}"`)}clearAll(){const e=[];for(let t=0;t<sessionStorage.length;t++){const o=sessionStorage.key(t);o.startsWith("collections_")&&e.push(o)}e.forEach(e=>sessionStorage.removeItem(e)),console.log(`  üóëÔ∏è Cleared ${e.length} cache entries`)}}class w{constructor(e="c09bba8e-4a81-49c2-b722-f1fa46c75861"){this.collectionId=e,this.baseUrl="https://wmkcwljhyweqzjivbupx.supabase.co/functions/v1/generic-collection-filter",this.abortController=null,this.responseCache=new Map,console.log("üåê CollectionAPI initialized")}buildRequestUrl(e){const t=new URLSearchParams({collection_id:this.collectionId,page:e.getCurrentPage().toString(),limit:e.itemsPerPage.toString(),sort:e.getCurrentSort()});Object.entries(e.getActiveFilters()).forEach(([e,o])=>{if(o.length>0){const s={application:"application-slugs",material:"material",featured:"featured",thickness:"thickness"};if(["colors","color","size","finish"].includes(e))t.set(`filter_${e}`,o.join(","));else{const n=s[e]||e;t.set(`filter_${n}`,o.join(","))}}});return t.set("config",JSON.stringify({searchFields:["name","description","actual-product-name"],sortFields:{"a-z":"name:asc","z-a":"name:desc",recommended:"sort-order:asc",featured:"featured:desc"},relatedItems:{enabled:!0,relationField:"variants"},relatedItemFields:["colors","color","size","finish"],customFilters:{"application-slugs":{type:"ilike"},material:{type:"exact"},featured:{type:"boolean"},thickness:{type:"numeric"},color:{type:"exact"},colors:{type:"exact"},size:{type:"array_contains"},finish:{type:"array_contains"}}})),`${this.baseUrl}?${t.toString()}`}async fetchItems(e){const t=this.buildRequestUrl(e);if(console.log("%c[API] Fetching items...","color: #00aaff"),console.log("  URL:",t),console.log("  Page:",e.getCurrentPage()),console.log("  Filters:",JSON.stringify(e.getActiveFilters())),this.responseCache.has(t))return console.log("  ‚úÖ Using cached API response"),this.responseCache.get(t);this.abortController&&this.abortController.abort(),this.abortController=new AbortController;try{const e=await fetch(t,{signal:this.abortController.signal});if(!e.ok){if(403===e.status)throw new Error("Access denied. Please contact support.");throw new Error(`HTTP ${e.status}: ${e.statusText}`)}const o=await e.text();let s;try{s=JSON.parse(o)}catch(e){throw console.error("JSON parse error:",e),console.error("Response text:",o),new Error("Invalid response format from server")}return this.responseCache.set(t,s),console.log(`  ‚úÖ Fetched ${s.items?.length||0} items`),console.log(`  Total items: ${s.pagination?.total||0}`),s}catch(e){if("AbortError"!==e.name)throw console.error("[API] Fetch error:",e),e;throw e}}clearCache(){this.responseCache.clear(),console.log("  üóëÔ∏è Cleared API response cache")}}class f{constructor(e){if(this.container=document.querySelector(e),!this.container)throw console.error(`Container not found: ${e}`),console.log("Available containers:",{productGrid:document.querySelector(".product-grid"),collectionList:document.querySelector(".collection_product-list")}),new Error(`Container not found: ${e}`);console.log("üé® CollectionRenderer initialized")}async renderItems(e,t=!1){console.log("%c[RENDER] Rendering items","color: #9900ff"),console.log(`  Items: ${e.length}, fromCache: ${t}`);this.container.querySelectorAll(".skeleton-item").length>0&&await this.removeSkeletonLoaders(!0),this.container.innerHTML="";const o=document.createDocumentFragment();e.forEach(e=>{const t=this.createProductElement(e);o.appendChild(t)}),this.container.appendChild(o);const s=this.container.querySelectorAll(".collection_grid-item");this.animateItemsIn(s),this.waitForImagesToLoad(this.container.querySelectorAll("img"))}async appendItems(e){console.log("%c[RENDER] Appending items","color: #9900ff"),console.log(`  Items: ${e.length}`),await this.removeSkeletonLoaders(!0);const t=document.createDocumentFragment();e.forEach(e=>{const o=this.createProductElement(e);t.appendChild(o)}),this.container.appendChild(t);const o=Array.from(this.container.querySelectorAll(".collection_grid-item")).slice(-e.length);this.animateItemsIn(o);const s=Array.from(this.container.querySelectorAll("img")).slice(4*-e.length);this.waitForImagesToLoad(s)}clear(){this.container.innerHTML=""}createProductElement(e){const t=e.name||e["actual-product-name"]||"Untitled",o=e.image?.url||"https://cdn.prod.website-files.com/plugins/Basic/assets/placeholder.60f9b1840c.svg",s=`/collections/${e.slug||e.webflow_item_id||""}`,n=document.createElement("div");return n.setAttribute("role","listitem"),n.className="w-dyn-item",n.innerHTML=`\n      <div class="collection_grid-item" data-base-url="${s}" data-product-id="${s}" data-hover-initialized="false">\n        <a href="${s}" class="collection_image-cover">\n          <img src="${o}" loading="lazy" alt="${t}" class="img-2" data-original-src="${o}">\n        </a>\n        <div class="progressive-blur">\n            <div class="blur"></div>\n        </div>\n        <div class="gradient-cover"></div>\n        <div class="collection-overlay">\n          <a href="${s}" class="collection_details">\n            <div class="truncate">${t}</div>\n          </a>\n          ${this.createProductMetaHTML(e)}\n          ${this.createVariantThumbnailsHTML(e.related_items,s)}\n        </div>\n      </div>\n    `,n}createProductMetaHTML(e){return`\n      <div data-thickness="${e.thickness||""}" data-applications="${e["application-slugs"]||""}" data-material="${e.material||""}" class="product-meta">\n        ${e.featured||!1?'<div class="is-featured-flag"></div>':""}\n      </div>\n    `}createVariantThumbnailsHTML(e,t){if(!e||0===e.length)return'\n        <div class="collection-list-wrapper w-dyn-list">\n          <div role="list" class="variant_thumbnail-list w-dyn-items"></div>\n        </div>\n      ';return`\n      <div class="collection-list-wrapper w-dyn-list">\n        <div role="list" class="variant_thumbnail-list w-dyn-items">\n          ${e.map(e=>{const o=e["image-3"]?.url||"https://cdn.prod.website-files.com/plugins/Basic/assets/placeholder.60f9b1840c.svg",s=e["finish-slugs"]||"",n=this.extractColorName(e.color,e.slug),i=e["size-slugs"]||"",a=e.name||e.slug||e.webflow_item_id||"",r=e.slug||e.webflow_item_id||"";return`\n          <div role="listitem" class="w-dyn-item">\n            <a href="${r?`${t}?variant=${r}`:t}" class="variant-thumb-link" style="display: block; line-height: 0;">\n              <img src="${o}" loading="lazy" alt="${a}" class="variant-thumb" style="cursor: pointer;">\n            </a>\n            <div data-finishes="${s}" data-name="${a}" data-slug="${r}" data-color="${n}" data-sizes="${i}" class="variant-meta"></div>\n          </div>\n        `}).join("")}\n        </div>\n      </div>\n    `}extractColorName(e,t){if(!e)return t||"";return e.replace(/\s*\(.*?\)\s*/g,"").trim()||t||""}showSkeletonLoaders(e){console.log(`  üíÄ Showing ${e} skeleton loaders`);for(let t=0;t<e;t++){const e=document.createElement("div");e.className="skeleton-item collection_grid-item",e.style.cssText="\n        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);\n        background-size: 200% 100%;\n        animation: shimmer 1.5s infinite;\n        border-radius: 8px;\n        min-height: 300px;\n        opacity: 0;\n      ",this.container.appendChild(e)}if(window.gsap){const e=this.container.querySelectorAll(".skeleton-item");gsap.to(e,{opacity:.6,duration:.3,ease:"power2.out",stagger:.05})}else{this.container.querySelectorAll(".skeleton-item").forEach((e,t)=>{setTimeout(()=>e.style.opacity="0.6",50*t)})}}async removeSkeletonLoaders(e=!1){const t=this.container.querySelectorAll(".skeleton-item");return 0===t.length?Promise.resolve():e&&window.gsap?new Promise(e=>{gsap.to(t,{opacity:0,duration:.2,ease:"power2.in",onComplete:()=>{t.forEach(e=>e.remove()),e()}})}):(t.forEach(e=>e.remove()),Promise.resolve())}animateItemsIn(e){window.gsap&&e&&0!==e.length&&(gsap.set(e,{opacity:0,y:20}),requestAnimationFrame(()=>{gsap.to(e,{opacity:1,y:0,duration:.5,ease:"power2.out",stagger:.025,delay:.15})}))}waitForImagesToLoad(e){if(!e||0===e.length)return;const t=Array.from(e).map(e=>e.complete?Promise.resolve():new Promise(t=>{e.addEventListener("load",t),e.addEventListener("error",t)}));Promise.all(t).then(()=>{window.lenis&&window.lenis.resize(),console.log("  üì∏ All images loaded, Lenis resized")})}}class y{constructor(e,t){if(this.container=document.querySelector(e),this.callback=t,this.observer=null,this.sentinel=null,!this.container)throw new Error(`Container not found: ${e}`);console.log("‚ôæÔ∏è  CollectionInfiniteScroll initialized")}init(){this.sentinel&&this.sentinel.remove(),this.sentinel=document.createElement("div"),this.sentinel.className="infinite-scroll-sentinel",this.sentinel.style.cssText="height: 1px; width: 100%; clear: both;",this.container.after(this.sentinel),this.observer=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(console.log("  ‚ôæÔ∏è  Sentinel visible - loading more items"),this.callback())})},{root:null,rootMargin:"200px",threshold:0}),this.observer.observe(this.sentinel),console.log("  ‚ôæÔ∏è  Observer attached to sentinel")}destroy(){this.observer&&(this.observer.disconnect(),this.observer=null),this.sentinel&&(this.sentinel.remove(),this.sentinel=null),console.log("  ‚ôæÔ∏è  Infinite scroll destroyed")}}class v{constructor(){this.state=new m,this.cache=new p,this.api=new w,this.renderer=new f(".product-grid"),this.infiniteScroll=null,this.isLoading=!1,console.log("üé¨ CollectionsPage initialized")}playPageEnterAnimation(){const e=document.querySelector('[data-taxi-view="collections"]');if(e&&(window.gsap?window.gsap.set(e,{opacity:1}):e.style.opacity="1",console.log("  üëÅÔ∏è  Page revealed (from playPageEnterAnimation)")),!window.gsap)return Promise.resolve();const t=window.gsap.timeline(),o=document.querySelector(".font-color-primary");if(o&&window.SplitText){const e=new window.SplitText(o,{type:"chars",charsClass:"char"});window.gsap.set(e.chars,{yPercent:100}),t.to(e.chars,{yPercent:0,duration:.65,ease:"expo.out",stagger:.007},0)}const s=document.querySelector("#filters-open");return s&&(window.gsap.set(s,{clearProps:"transform"}),window.gsap.set(s,{yPercent:100}),t.to(s,{yPercent:0,duration:.65,ease:"expo.out"},.035)),t}playPageExitAnimation(){if(!window.gsap)return Promise.resolve();const e=window.gsap.timeline(),t=document.querySelector(".font-color-primary");if(t&&window.SplitText){const o=new window.SplitText(t,{type:"chars",charsClass:"char"});e.to(o.chars,{yPercent:100,duration:.35,ease:"power2.in",stagger:.005},0)}const o=document.querySelector("#filters-open");o&&e.to(o,{yPercent:100,duration:.35,ease:"power2.in"},.035);const s=document.querySelectorAll(".collection_grid-item");return s.length>0&&e.to(s,{opacity:0,y:15,duration:.32,ease:"power2.in",stagger:.013},.07),e}async init(e=!1){console.log("%c========== COLLECTIONS INIT ==========","color: #00ff00; font-weight: bold"),console.log(`URL: ${window.location.href}`),console.log(`Back button: ${e}`),u("collections",{playExitAnimation:()=>this.playPageExitAnimation()}),this.playPageEnterAnimation(),this.loadURLParams();const t=this.cache.restore(e);t?(this.state.fromJSON(t),await this.renderer.renderItems(this.state.getItems(),!0),this.updateUI(),e&&this.state.clickedProductId&&(window.__pendingScrollRestoration=this.state.clickedProductId),console.log(`‚úÖ Restored from cache: ${this.state.getItems().length}/${this.state.getTotalItems()} items`)):(console.log("  üì° No cache - fetching fresh data"),await this.loadInitialData()),this.initInfiniteScroll(),this.cache.save(this.state),console.log("%c========== INIT COMPLETE ==========","color: #00ff00; font-weight: bold")}loadURLParams(){const e=new URLSearchParams(window.location.search),t=e.get("sort");t&&this.state.setCurrentSort(t);const o={};for(const[t,s]of e.entries())["sort","page","limit","config","collection_id"].includes(t)||s&&(o[t]=s.split(","));this.state.setActiveFilters(o),console.log("  üìÑ Loaded from URL:",{sort:this.state.getCurrentSort(),filters:this.state.getActiveFilters()})}async loadInitialData(){this.state.reset(),await this.fetchItems()}async fetchItems(e=!1){if(!this.isLoading){this.isLoading=!0;try{if(e){const e=this.state.getTotalItems()-this.state.getItems().length,t=Math.min(e,this.state.itemsPerPage);this.renderer.showSkeletonLoaders(t)}else this.renderer.showSkeletonLoaders(this.state.itemsPerPage);await new Promise(e=>setTimeout(e,150));const t=await this.api.fetchItems(this.state);e?this.state.appendItems(t.items):this.state.setItems(t.items),this.state.setTotalItems(t.pagination.total),this.state.setHasMorePages(t.pagination.hasMore||!1),console.log("  üìä Pagination updated:",{currentPage:this.state.getCurrentPage(),itemsLoaded:this.state.getItems().length,totalItems:this.state.getTotalItems(),hasMore:t.pagination.hasMore,hasMoreInState:this.state.hasMorePages}),e?await this.renderer.appendItems(t.items):await this.renderer.renderItems(t.items),this.updateUI(),this.state.incrementPage(),console.log(`  üìÑ Next page will be: ${this.state.getCurrentPage()}`),this.cache.save(this.state),console.log(`‚úÖ Fetch complete: ${this.state.getItems().length}/${this.state.getTotalItems()} items loaded`)}catch(e){"AbortError"!==e.name&&(console.error("Fetch error:",e),this.handleError(e))}finally{this.isLoading=!1}}}initInfiniteScroll(){this.infiniteScroll&&this.infiniteScroll.destroy(),this.infiniteScroll=new y(".product-grid",()=>{console.log("  ‚ôæÔ∏è  Infinite scroll triggered:",{hasMorePages:this.state.hasMorePages,isLoading:this.isLoading,itemsLoaded:this.state.getItems().length,totalItems:this.state.getTotalItems()}),this.state.hasMorePages&&!this.isLoading?this.fetchItems(!0):this.state.hasMorePages?this.isLoading&&console.log("  ‚è≥ Already loading, skipping"):console.log("  ‚õî No more pages to load")}),this.infiniteScroll.init()}updateUI(){const e=document.querySelector("[data-results-count]");e&&(e.textContent=this.state.getTotalItems());const t=document.querySelector(".button.alt");if(t){const e=this.state.hasFilters();t.style.opacity=e?"1":"0.5",t.disabled=!e}}handleError(e){console.error("CollectionsPage error:",e),this.renderer.clear(),this.renderer.container.innerHTML=`\n      <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; background: #fee; border: 1px solid #fcc; border-radius: 8px; color: #c33;">\n        <h3>Error loading products</h3>\n        <p>${e.message}</p>\n        <button onclick="window.location.reload()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: #c33; color: white; border: none; border-radius: 4px; cursor: pointer;">\n          Reload Page\n        </button>\n      </div>\n    `}destroy(){this.infiniteScroll&&this.infiniteScroll.destroy(),this.cache.save(this.state),console.log("  üëã CollectionsPage destroyed")}}function S(){const e=a();return class extends e{initialLoad(){this.onEnter(),this.onEnterCompleted()}async onEnter(){const e=window.__taxiNavigationTrigger,t="popstate"===e;console.log("üé¨ CollectionsRenderer onEnter - trigger:",e,"isBackButton:",t),await async function(e=!1){const t=new v;return await t.init(e),t}(t)}}}function I(){if(!window.gsap)return Promise.resolve();const e=gsap.timeline();[{selector:"#applications",start:0},{selector:"#thickness",start:.025},{selector:"#material",start:.05},{selector:".variant-finishes",start:.075},{selector:".variant-sizes",start:.1},{selector:".variant-buttons",start:.125}].forEach(({selector:t,start:o})=>{const s=document.querySelector(t);s&&e.to(s,{opacity:0,yPercent:20,duration:.35,ease:"power2.in"},o)});const t=document.querySelector(".product-description");if(t&&window.SplitText){const o=new SplitText(t,{type:"lines"});o.lines.forEach(e=>{if(!e.parentNode.style.overflow){const t=document.createElement("div");t.style.overflow="hidden",e.parentNode.insertBefore(t,e),t.appendChild(e)}}),e.to(o.lines,{yPercent:100,duration:.35,ease:"power2.in",stagger:.025/o.lines.length},.15)}const o=document.querySelector("#product-title");if(o&&window.SplitText){const t=new SplitText(o,{type:"chars"});e.to(t.chars,{opacity:0,yPercent:20,duration:.35,ease:"power2.in",stagger:.05/t.chars.length},.175)}const s=document.querySelector(".hero-cover");return s&&e.to(s,{width:"100%",duration:.45,ease:"expo.inOut"},.2),e}async function x(e){window.SplitText||await l("https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/SplitText.min.js"),await c("https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0/dist/carousel/carousel.css"),await c("https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0/dist/fancybox/fancybox.css"),window.Carousel||await l("https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0/dist/carousel/carousel.umd.js"),window.Fancybox||await l("https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0/dist/fancybox/fancybox.umd.js"),window.Arrows||await l("https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0/dist/carousel/carousel.arrows.umd.js"),window.Dots||await l("https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0/dist/carousel/carousel.dots.umd.js"),window.Thumbs||await l("https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0/dist/carousel/carousel.thumbs.umd.js");const t=document.getElementById("product-carousel"),o=document.querySelector(".product-image"),s=document.querySelector("[data-product-name]");if(!t||!o||!s)return void u("product",{playExitAnimation:()=>I(),destroy:()=>{}});u("product",{playExitAnimation:()=>I(),destroy:()=>{}}),function(){const e=document.querySelector('[data-taxi-view="product"]');if(e&&(window.gsap?gsap.set(e,{opacity:1}):e.style.opacity="1"),!window.gsap)return Promise.resolve();const t=gsap.timeline(),o=document.querySelector(".hero-cover");o&&(gsap.set(o,{width:"100%"}),t.to(o,{width:"0%",duration:.85,ease:"expo.inOut"},0));const s=document.querySelector("#product-title");if(s&&window.SplitText){const e=new SplitText(s,{type:"chars"});gsap.set(e.chars,{opacity:0,yPercent:20}),t.to(e.chars,{opacity:1,yPercent:0,duration:.85,ease:"expo.out",stagger:.17/e.chars.length},.17)}const n=document.querySelector(".product-description");if(n&&window.SplitText){const e=new SplitText(n,{type:"lines",linesClass:"split-line"});e.lines.forEach(e=>{const t=document.createElement("div");t.style.overflow="hidden",e.parentNode.insertBefore(t,e),t.appendChild(e)}),gsap.set(e.lines,{yPercent:100}),t.to(e.lines,{yPercent:0,duration:.85,ease:"expo.out",stagger:.085/e.lines.length},.3)}[{selector:".variant-buttons",start:.45},{selector:".variant-sizes",start:.51},{selector:".variant-finishes",start:.59},{selector:"#material",start:.66},{selector:"#thickness",start:.73},{selector:"#applications",start:.8}].forEach(({selector:e,start:o})=>{const s=document.querySelector(e);s&&(gsap.set(s,{opacity:0,yPercent:20}),t.to(s,{opacity:1,yPercent:0,duration:.7,ease:"expo.out"},o))})}();const n=new class{constructor(){this.slides=[],this.variants=[],this.selectedVariant=null,this.carousel=null,this.fancybox=null,this.initialSlideIndex=0,this.isInitialLoad=!0,this._ac=new AbortController,this.init()}init(){this.extractProductData(),this.determineInitialSlide(),this.buildCarousel(),this.buildVariantButtons(),this.setupFancybox();const e=document.querySelector(".variant-info");e&&(e.style.display="none"),this.handleInitialVariant()}extractProductData(){const e=document.querySelector(".product-image"),t=document.querySelector("[data-product-name]").textContent;this.slides=[{type:"main",src:e.src,alt:`${t} - Main Image`,variantSlug:null,w:1200,h:800}],this.variants=[];document.querySelectorAll(".variants-list .w-dyn-item").forEach(e=>{const o=e.children[0],s=e.querySelector("img"),n=e.querySelector(".product-variant-meta"),i={name:o.textContent,slug:n.dataset.variantSlug,image:s.src,sizes:n.dataset.sizes.split(",").map(e=>e.trim()),finishes:n.dataset.finishes.split(",").map(e=>e.trim())};this.variants.push(i),this.slides.push({type:"variant",src:i.image,alt:`${t} - ${i.name}`,variantSlug:i.slug,w:1200,h:800})})}determineInitialSlide(){const e=new URLSearchParams(window.location.search).get("variant");if(this.initialSlideIndex=0,e&&this.variants.some(t=>t.slug===e)){const t=this.slides.findIndex(t=>t.variantSlug===e);if(-1!==t)return this.initialSlideIndex=t,void(this.selectedVariant=e)}this.variants.length>0?this.selectedVariant=this.variants[0].slug:this.selectedVariant=null}buildCarousel(){const e=document.getElementById("product-carousel");if(e){e.innerHTML="",this.slides.forEach(t=>{const o=document.createElement("div");o.className="f-carousel__slide";const s=document.createElement("img");s.src=t.src,s.alt=t.alt,s.dataset.fancybox="gallery",s.dataset.src=t.src,s.dataset.caption=t.alt,s.className="carousel-image",s.style.cursor="pointer",o.appendChild(s),e.appendChild(o)});try{this.carousel=Carousel(e,{infinite:!0,center:!0,fill:!0,dragFree:!1,initialPage:this.initialSlideIndex},{Arrows:Arrows,Thumbs:Thumbs}).init()}catch(e){console.error("Failed to initialize Carousel:",e)}}}setupFancybox(){Fancybox.bind('[data-fancybox="gallery"]',{Carousel:{Toolbar:{display:{right:["zoomIn","zoomOut","thumbs","close"]}}}})}buildVariantButtons(){const e=document.querySelector(".variant-buttons");e&&(e.innerHTML="",this.variants.forEach(t=>{const o=document.createElement("button");o.className="variant-btn",o.dataset.variantSlug=t.slug,o.innerHTML=`\n          <img src="${t.image}" alt="${t.name}" class="variant-btn-image">\n          <span>${this.slugToName(t.name)}</span>\n        `,o.addEventListener("click",()=>{this.isInitialLoad=!1,this.selectVariant(t.slug,!0)},{signal:this._ac.signal}),e.appendChild(o)}))}handleInitialVariant(){if(this.selectedVariant){new URLSearchParams(window.location.search).get("variant")===this.selectedVariant?this.selectVariant(this.selectedVariant,!0,!1):this.selectVariant(this.selectedVariant,!1,!1)}setTimeout(()=>{this.isInitialLoad=!1},100)}selectVariant(e,t=!0,o=!0){if(this.selectedVariant=e,document.querySelectorAll(".variant-btn").forEach(t=>{t.classList.toggle("selected",t.dataset.variantSlug===e)}),t&&this.carousel){const t=this.slides.findIndex(t=>t.variantSlug===e);if(-1!==t)try{"function"==typeof this.carousel.slideTo?this.carousel.slideTo(t):"function"==typeof this.carousel.goTo?this.carousel.goTo(t):this.carousel.page=t}catch(e){console.error("Error navigating to slide:",e)}}this.displayVariantInfo(e),o&&this.updateURLParams()}displayVariantInfo(e){const t=document.querySelector(".variant-info");if(!e)return void(t&&(t.style.display="none"));const o=this.variants.find(t=>t.slug===e);if(!o)return void(t&&(t.style.display="none"));const s=document.querySelector(".variant-name"),n=document.querySelector(".sizes-list"),i=document.querySelector(".finishes-list");t&&s&&n&&i&&(s.textContent=this.slugToName(o.name),n.innerHTML="",i.innerHTML="",o.sizes.forEach(e=>{const t=document.createElement("div");t.className="size-item",t.textContent=this.slugToName(e),n.appendChild(t)}),o.finishes.forEach(e=>{const t=document.createElement("div");t.className="finish-item",t.textContent=this.slugToName(e),i.appendChild(t)}),t.style.display="block")}slugToName(e){return e.split(/[-_\s]+/).map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" ")}updateURLParams(){const e=new URL(window.location);this.selectedVariant?e.searchParams.set("variant",this.selectedVariant):e.searchParams.delete("variant"),window.history.replaceState(null,"",e)}destroy(){try{this._ac?.abort?.()}catch(e){}try{this.carousel?.destroy?.()}catch(e){}try{window.Fancybox&&Fancybox.destroy&&Fancybox.destroy()}catch(e){}}};u("product",{...{playExitAnimation:()=>I()},destroy:()=>n.destroy()})}function b(){if(void 0===window.taxi)return console.error("‚ùå Taxi.js not found! Make sure BOTH @unseenco/e AND @unseenco/taxi CDN scripts are loaded."),null;const e=a(),t=function(){const e=a();return class extends e{initialLoad(){g(),this.onEnter(),this.onEnterCompleted()}async onEnter(){await g()}}}(),s=S(),r=function(){const e=a();return class extends e{initialLoad(){x(),this.onEnter(),this.onEnterCompleted()}async onEnter(){await x()}}}(),l=window.taxi?class extends window.taxi.Transition{onLeave({from:e,done:t}){if(!window.gsap)return void t();const o=e.getAttribute("data-taxi-view");let s=null;if("home"===o){const e=h("home");s=e?.playExitAnimation?.()}else if("collections"===o){const e=h("collections");s=e?.playExitAnimation?.()}else if("product"===o){const e=h("product");s=e?.playExitAnimation?.()}s?s.eventCallback("onComplete",()=>{gsap.to(e,{opacity:0,duration:.15,ease:"power2.out",onComplete:t})}):gsap.to(e,{opacity:0,duration:.2,ease:"power2.out",onComplete:t})}onEnter({to:e,trigger:t,done:o}){window.gsap?(window.scrollTo(0,0),gsap.set(e,{opacity:0}),o()):o()}}:(console.error("taxi not loaded!"),class{}),c=new window.taxi.Core({links:'a:not([target]):not([href^="#"]):not([data-taxi-ignore])',removeOldContent:!0,allowInterruption:!1,enablePrefetch:!0,transitions:{default:l},renderers:{default:e,home:t,collections:s,product:r}});return i(),n(),"scrollRestoration"in history&&(history.scrollRestoration="manual"),window.__taxiNavigationTrigger=null,c.on("NAVIGATE_IN",({trigger:e})=>{window.__taxiNavigationTrigger=e,console.log("üöï NAVIGATE_IN - trigger:",e)}),c.on("NAVIGATE_OUT",({from:e})=>{o(!0),window.lenis&&(window.lenis.stop(),console.log("üõë Stopped Lenis momentum scroll"))}),c.on("NAVIGATE_END",({to:e})=>{if(n(window.location.pathname),(()=>{if(window.Webflow&&window.Webflow.require)try{window.Webflow.destroy(),window.Webflow.ready(),window.Webflow.require("ix2").init()}catch(e){}})(),window.lenis&&(window.lenis.start(),console.log("‚ñ∂Ô∏è Restarted Lenis")),window.__pendingScrollRestoration){const e=window.__pendingScrollRestoration;window.__pendingScrollRestoration=null,console.log("üîç Executing delayed scroll restoration for:",e),setTimeout(()=>{if(window.lenis){window.lenis.resize();const t=document.querySelector(`[data-product-id="${e}"]`);if(t){const o=t.getBoundingClientRect(),s=window.pageYOffset+o.top;console.log("üéØ Smoothly scrolling to product:",e),console.log("  - Element position:",s),console.log("  - Target (with offset):",s-100),window.lenis.scrollTo(t,{duration:.6,offset:-100,easing:e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2}),setTimeout(()=>{console.log("‚úÖ Final scroll position:",window.scrollY)},700)}else console.warn("‚ö†Ô∏è Product element not found:",e)}},200)}}),c.on("NAVIGATE_ERROR",e=>{console.error("‚ùå Navigation error:",e)}),c}console.log("%cüöï Versatile Site v4.0.4","color: #00ff00; font-weight: bold;"),console.log("%c‚úÖ Complete: Page enter/exit animations + setState registration","color: #00ff00;"),document.addEventListener("DOMContentLoaded",()=>{const e=b();e?(console.log("%c‚úÖ Taxi.js ready","color: #00ff00;"),window.taxi=e):console.error("%c‚ùå Taxi.js failed to initialize","color: #ff0000;")})}();
