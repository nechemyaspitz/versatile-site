!function(){"use strict";const e='[data-navigation] a[href]:not([target="_blank"]):not([data-no-barba])';function t(){return document.querySelector("[data-navigation-status]")}function i(e=!1){const i=t();i&&i.setAttribute("data-navigation-status","not-active")}function s(){const e=t();if(!e)return;const i="active"===e.getAttribute("data-navigation-status");e.setAttribute("data-navigation-status",i?"not-active":"active")}function n(t=location.pathname){let i=document.querySelectorAll(e);0===i.length&&(i=document.querySelectorAll('.hamburger-nav a[href]:not([target="_blank"])')),0===i.length&&(i=document.querySelectorAll('nav a[href]:not([target="_blank"]):not([data-taxi-ignore])')),i.forEach(e=>{const i=e.getAttribute("href")||"";try{const s=new URL(i,location.origin).pathname===t;e.classList.toggle("w--current",s),s?e.setAttribute("aria-current","page"):e.removeAttribute("aria-current")}catch(e){}})}function o(){o._ac?.abort?.();const t=new AbortController;o._ac=t,document.querySelectorAll('[data-navigation-toggle="toggle"]').forEach(e=>{e.addEventListener("click",s,{signal:t.signal})}),document.querySelectorAll('[data-navigation-toggle="close"]').forEach(e=>{e.addEventListener("click",i,{signal:t.signal})}),document.addEventListener("keydown",e=>{"Escape"===e.key&&i()},{signal:t.signal}),document.querySelectorAll(e).forEach(e=>{e.addEventListener("click",()=>i(!0),{signal:t.signal})})}function r(){return window.taxi?class extends window.taxi.Renderer{initialLoad(){this.onEnter(),this.onEnterCompleted()}onEnter(){}onEnterCompleted(){}onLeave(){}onLeaveCompleted(){}}:(console.error("taxi not loaded!"),class{})}const a=new Set,l=(e,t={})=>a.has(e)?Promise.resolve():new Promise((i,s)=>{const n=document.createElement("script");n.src=e,n.async=!0,Object.entries(t).forEach(([e,t])=>n.setAttribute(e,t)),n.onload=()=>{a.add(e),i()},n.onerror=s,document.head.appendChild(n)}),c=e=>a.has(e)?Promise.resolve():new Promise((t,i)=>{const s=document.createElement("link");s.rel="stylesheet",s.href=e,s.onload=()=>{a.add(e),t()},s.onerror=i,document.head.appendChild(s)}),d=new Map,u=(e,t)=>d.set(e,t),h=e=>d.get(e)||{};async function p(e){window.gsap||await l("https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"),await c("https://cdn.jsdelivr.net/npm/swiper@12/swiper-bundle.min.css"),window.Swiper||await l("https://cdn.jsdelivr.net/npm/swiper@12/swiper-bundle.min.js");const t=document.querySelector(".swiper");if(!t)return void u("home",{destroy:()=>{}});const i=window.matchMedia("(prefers-reduced-motion: reduce)").matches,s=i?0:1.45;let n=null,o=null,r=null,a=0,d=null;if(window.SplitText&&window.gsap&&gsap.registerPlugin)try{gsap.registerPlugin(SplitText)}catch(e){}function h(e){if(!e||!window.SplitText)return null;if(e.__split)return e.__split;const t=e.querySelector(".slider-product-name");if(!t)return null;const i=new SplitText(t,{type:"chars"});return e.__split=i,gsap.set(i.chars,{yPercent:120,rotate:6,opacity:0,transformOrigin:"0% 100%",willChange:"transform, opacity"}),i}function p(e,t){const i=e.slides[t].swiperSlideOffset||0;return e.rtlTranslate?i:-i}function m(e,t){i||(e.setTranslate(t),e.slides.forEach(e=>{const t=e.querySelector(".slider-img");if(!t)return;const i="number"==typeof e.progress?e.progress:0;gsap.set(t,{xPercent:28*i})}))}function g(){r&&(r.kill(),r=null)}function f(e){g(),i||(r=gsap.delayedCall(4.2,e))}function y(e,t="next"){if(!n)return;g(),o&&(o.kill(),o=null);const i=function(e){let t=-1;return e.slides.forEach(e=>{const i=parseInt(e.getAttribute("data-swiper-slide-index")||"0",10);!Number.isNaN(i)&&i>t&&(t=i)}),t+1}(e),r=e.activeIndex,l=e.slides[r];let c;c="next"===t?(e.realIndex+1)%i:"prev"===t?(e.realIndex-1+i)%i:"number"==typeof t?(t%i+i)%i:(e.realIndex+1)%i,e.updateSlides(),e.updateSlidesOffset();const d=function(e,t,i){let s=-1,n=1/0;return e.slides.forEach((o,r)=>{if(parseInt(o.getAttribute("data-swiper-slide-index")||"-1",10)!==t)return;const a=p(e,r),l=Math.abs(a-i);l<n&&(n=l,s=r)}),s}(e,c,a);e.slideTo(d,0,!1),e.updateSlides(),e.updateSlidesOffset();const u=e.activeIndex,w=e.slides[u],v=a;let S=p(e,u);if(v===S){const t=e.rtlTranslate?-1:1;S-=t*e.width}o=gsap.timeline({onUpdate:()=>{const t=gsap.getProperty(n,"x");m(e,t)},onComplete:()=>{a=S,f(()=>y(e,"next"))}}),function(e){const t=h(e);t&&(gsap.killTweensOf(t.chars),gsap.to(t.chars,{yPercent:-120,rotate:-4,opacity:0,duration:.5,ease:"power2.in",stagger:{each:.015,from:"end"},onComplete:()=>{gsap.set(t.chars,{yPercent:120,rotate:6,opacity:0})}}))}(l),function(e){const t=h(e);t&&(gsap.killTweensOf(t.chars),gsap.set(t.chars,{yPercent:120,rotate:6,opacity:0}))}(w),o.fromTo(n,{x:v},{x:S,duration:s,ease:"power4.inOut"},0),o.add(()=>function(e){const t=h(e);t&&(gsap.killTweensOf(t.chars),gsap.to(t.chars,{yPercent:0,rotate:0,opacity:1,duration:.9,ease:"power3.out",stagger:{each:.02,from:"start"}}))}(w),.3*s)}const w=new Swiper(".swiper",{loop:!0,slidesPerView:1,allowTouchMove:!1,speed:0,virtualTranslate:!0,watchSlidesProgress:!0,on:{init(e){n=e.el.querySelector(".swiper-wrapper"),e.slides.forEach(h),e.updateSlides(),e.updateSlidesOffset(),a=p(e,e.activeIndex),gsap.set(n,{x:a,willChange:"transform",force3D:!0}),m(e,a);(function(e){const s=gsap.timeline(),n=document.querySelector(".hero-heading");n&&s.fromTo(n,{opacity:0,scale:.8},{opacity:1,scale:1,duration:1,ease:"expo.inOut",transformOrigin:"top left"},0);const o=document.querySelectorAll(".btn-group > *");o.length>0&&s.fromTo(o,{yPercent:102},{yPercent:0,duration:1,ease:"expo.inOut",stagger:.05},.1);const r=document.querySelector(".hero-cover");r&&s.fromTo(r,{width:"100%"},{width:"0%",duration:1,ease:"expo.inOut"},.34);const a=document.querySelector(".sm-premium");if(a&&window.SplitText){const e=new SplitText(a,{type:"chars"});s.fromTo(e.chars,{opacity:0},{opacity:1,duration:1.27,ease:"power1.out",stagger:.02},.47)}if(t&&s.fromTo(t,{scale:1.1},{scale:1,duration:1.25,ease:"expo.out"},.5),e&&!i){const t=h(e.slides[e.activeIndex]);t&&s.to(t.chars,{yPercent:0,rotate:0,opacity:1,duration:.9,ease:"power3.out",stagger:{each:.02,from:"start"}},.8)}return s})(e).then(()=>{f(()=>y(e,"next"))})},resize(e){e.updateSlides(),e.updateSlidesOffset(),a=p(e,e.activeIndex),gsap.set(n,{x:a}),m(e,a)}}}),v=()=>{document.hidden?g():f(()=>y(w,"next"))};document.addEventListener("visibilitychange",v),u("home",{playExitAnimation:()=>(d=function(){const e=gsap.timeline(),i=document.querySelector(".sm-premium");if(i&&window.SplitText){const t=new SplitText(i,{type:"chars"});e.fromTo(t.chars,{opacity:1},{opacity:0,duration:.8,ease:"power1.out",stagger:.01},0)}const s=document.querySelector(".hero-heading");s&&e.fromTo(s,{opacity:1,scale:1},{opacity:0,scale:.8,duration:1,ease:"expo.inOut",transformOrigin:"top left"},0);const n=document.querySelectorAll(".btn-group > *");n.length>0&&e.fromTo(n,{yPercent:0},{yPercent:102,duration:1,ease:"expo.inOut",stagger:.05},.06);const o=document.querySelector(".hero-cover");return o&&e.fromTo(o,{width:"0%"},{width:"100%",duration:1,ease:"expo.inOut"},.19),t&&e.fromTo(t,{scale:1},{scale:.5,duration:1,ease:"expo.in"},.19),e}(),d),destroy:()=>{try{document.removeEventListener("visibilitychange",v)}catch(e){}try{g()}catch(e){}try{o?.kill?.()}catch(e){}try{w?.destroy?.(!0,!0)}catch(e){}try{enterAnimation?.kill?.()}catch(e){}try{d?.kill?.()}catch(e){}}})}function m(){m._ac?.abort?.();const e=new AbortController;m._ac=e;const t=document.querySelector("#filters-open"),i=document.querySelector(".close-filters"),s=document.querySelector(".filter-drawer"),n=document.querySelector(".filter-controls");if(!s||!n)return;if(!window.gsap)return;gsap.set(s,{clearProps:"all"}),gsap.set(n,{clearProps:"all"}),gsap.set(s,{display:"none",opacity:0}),gsap.set(n,{xPercent:100});let o=0;t&&t.addEventListener("click",()=>{o=window.pageYOffset,document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.top=`-${o}px`,document.body.style.width="100%",gsap.set(s,{display:"flex"});gsap.timeline({defaults:{ease:"power1.inOut"}}).to(s,{opacity:1,duration:.1}).to(n,{xPercent:0,ease:"power4.out",duration:.4},.06)},{signal:e.signal}),i&&i.addEventListener("click",()=>{gsap.timeline({defaults:{ease:"power1.inOut",duration:.1},onComplete:()=>{gsap.set(s,{display:"none"}),document.body.style.overflow="",document.body.style.position="",document.body.style.top="",document.body.style.width="",window.scrollTo(0,o)}}).to(n,{xPercent:100,ease:"power4.in",duration:.2}).to(s,{opacity:0,duration:.05},"-=0.1")},{signal:e.signal})}const g=window.requestIdleCallback||function(e,t){return setTimeout(()=>e({didTimeout:!1,timeRemaining:()=>50}),1)};function f(){if(!window.gsap)return Promise.resolve();const e=gsap.timeline(),t=document.querySelector(".font-color-primary");if(t&&window.SplitText){const i=new SplitText(t,{type:"chars",charsClass:"char"});e.to(i.chars,{yPercent:100,duration:.4,ease:"power2.in",stagger:.006},0)}const i=document.querySelector("#filters-open");i&&e.to(i,{yPercent:100,duration:.4,ease:"power2.in"},.04);const s=document.querySelectorAll(".collection_grid-item");return s.length>0&&e.to(s,{opacity:0,y:15,duration:.35,ease:"power2.in",stagger:.015},.08),e}async function y(e=!1){console.log("🎬 initCollections called with isBackButton:",e),window.gsap||await l("https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"),window.SplitText||await l("https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/SplitText.min.js"),await c("https://cdn.jsdelivr.net/npm/nice-select2@2.1.0/dist/css/nice-select2.css"),window.NiceSelect||await l("https://cdn.jsdelivr.net/npm/nice-select2@2.1.0/dist/js/nice-select2.js");const t=document.querySelector(".product-grid"),i=document.getElementById("filters");if(!t||!i)return void u("collections",{playExitAnimation:()=>f(),destroy:()=>{}});u("collections",{playExitAnimation:()=>f(),destroy:()=>{}}),function(){if(!window.gsap)return Promise.resolve();const e=gsap.timeline(),t=document.querySelector(".font-color-primary");if(t&&window.SplitText){const i=new SplitText(t,{type:"chars",charsClass:"char"});gsap.set(i.chars,{yPercent:100,willChange:"transform"}),e.to(i.chars,{yPercent:0,duration:1,ease:"expo.out",stagger:.01},0)}const i=document.querySelector("#filters-open");i&&e.fromTo(i,{yPercent:100},{yPercent:0,duration:1,ease:"expo.out"},.2)}(),m(),function(){if(!window.gsap)return;document.querySelectorAll(".filter-header").forEach(e=>{if("true"===e.dataset.accordionInit)return;const t=e.closest(".filter-group"),i=e.querySelector(".icon-sm");if(!t||!i)return;const s=gsap.timeline({paused:!0,onComplete:()=>{e._isOpen=!0},onReverseComplete:()=>{e._isOpen=!1}});s.fromTo(t,{height:"2em"},{height:"auto",duration:.25,ease:"power3.inOut"},0),s.fromTo(i,{rotation:-90},{rotation:0,duration:.25,ease:"power3.inOut"},0),e._timeline=s,e._isOpen=!1,e.addEventListener("click",()=>{s.isActive()?s.reversed(!s.reversed()):e._isOpen?(s.reverse(),e._isOpen=!1):(s.play(),e._isOpen=!0)}),e.dataset.accordionInit="true"})}();const s=new class{constructor(){this.productContainer=document.querySelector(".product-grid"),this.filterForm=document.getElementById("filters"),this.sortDropdown=document.getElementById("sort-select"),this.resultsCounter=document.querySelector("[data-results-count]"),this.clearButton=document.querySelector(".button.alt"),this.collectionId="c09bba8e-4a81-49c2-b722-f1fa46c75861",this.baseUrl="https://wmkcwljhyweqzjivbupx.supabase.co/functions/v1/generic-collection-filter",this.activeFilters={},this.currentSort="recommended",this.currentPage=1,this.itemsPerPage=10,this.isLoading=!1,this.hasMorePages=!0,this.totalItems=0,this.niceSelect=null,this._ac=new AbortController,this._observer=null,this._sentinel=null,this._respCache=new Map,this._allLoadedItems=[],this._clickedProductId=null}async init(e=!1){try{if(this.tryRestoreFromSession(e))return this.initNiceSelect(),this.initEventListeners(),void this.initInfiniteScroll();this.initNiceSelect(),this.loadFromURLParams(),this.initEventListeners(),this.initInfiniteScroll(),await this.loadInitialData()}catch(e){console.error("Error initializing filter:",e),this.handleError(e)}}async loadInitialData(){this.currentPage=1,this.hasMorePages=!0,this.clearProductContainer(),await this.fetchItems()}async fetchItems(e=!1){if(!this.isLoading){this.isLoading=!0;try{const t=this.buildRequestUrl();if(this._respCache.has(t)){const i=this._respCache.get(t);return e?this.appendItems(i.items):this.renderItems(i.items,!0),this.updatePagination(i.pagination),this.updateResultsCounter(i.pagination.total),this.updateClearButton(),void(this.isLoading=!1)}if(e){const e=this.totalItems-this._allLoadedItems.length,t=Math.min(e,this.itemsPerPage);this.showSkeletonLoaders(t)}else this.showSkeletonLoaders(this.itemsPerPage);const i=await fetch(t);if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);const s=await this.handleResponse(i);this._respCache.set(t,s),await new Promise(e=>setTimeout(e,150)),e?this.appendItems(s.items):this.renderItems(s.items),this.updatePagination(s.pagination),this.updateResultsCounter(s.pagination.total),this.updateClearButton(),this.saveToSession()}catch(e){console.error("Fetch error:",e),this.handleError(e)}finally{this.isLoading=!1}}}async handleResponse(e){const t=await e.text();if(!e.ok){if(403===e.status)throw new Error("Access denied. Please contact support.");throw new Error(`Server error: ${e.status} ${e.statusText}`)}try{return JSON.parse(t)}catch(e){throw console.error("JSON parse error:",e),console.error("Response text:",t),new Error("Invalid response format from server")}}buildRequestUrl(){const e=new URLSearchParams({collection_id:this.collectionId,page:this.currentPage.toString(),limit:this.itemsPerPage.toString(),sort:this.currentSort});Object.entries(this.activeFilters).forEach(([t,i])=>{if(i.length>0){const s={application:"application-slugs",material:"material",featured:"featured",thickness:"thickness"};if(["colors","color","size","finish"].includes(t))e.set(`filter_${t}`,i.join(","));else{const n=s[t]||t;e.set(`filter_${n}`,i.join(","))}}});return e.set("config",JSON.stringify({searchFields:["name","description","actual-product-name"],sortFields:{"a-z":"name:asc","z-a":"name:desc",recommended:"sort-order:asc",featured:"featured:desc"},relatedItems:{enabled:!0,relationField:"variants"},relatedItemFields:["colors","color","size","finish"],customFilters:{"application-slugs":{type:"ilike"},material:{type:"exact"},featured:{type:"boolean"},thickness:{type:"numeric"},color:{type:"exact"},colors:{type:"exact"},size:{type:"array_contains"},finish:{type:"array_contains"}}})),`${this.baseUrl}?${e.toString()}`}createSkeletonLoader(e=10){const t=document.createDocumentFragment();for(let i=0;i<e;i++){const e=document.createElement("div");e.className="skeleton-item",e.setAttribute("role","listitem"),e.style.cssText=`\n          width: 100%;\n          height: 100%;\n          min-height: 300px;\n          background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);\n          background-size: 200% 100%;\n          animation: skeleton-pulse 2s ease-in-out infinite;\n          animation-delay: ${.1*i}s;\n          border-radius: 4px;\n        `,t.appendChild(e)}return t}showSkeletonLoaders(e=10){this.removeSkeletonLoaders();const t=this.createSkeletonLoader(e);this.productContainer.appendChild(t)}removeSkeletonLoaders(e=!1){const t=this.productContainer.querySelectorAll(".skeleton-item");return e&&window.gsap&&t.length>0?new Promise(e=>{gsap.to(t,{opacity:0,duration:.3,ease:"power2.out",onComplete:()=>{t.forEach(e=>e.remove()),e()}})}):(t.forEach(e=>e.remove()),Promise.resolve())}async renderItems(e,t=!1){if(this.productContainer.querySelectorAll(".skeleton-item").length>0){const t=this.removeSkeletonLoaders(!0),i=document.createDocumentFragment();e.forEach(e=>{const t=this.createProductElement(e);i.appendChild(t)}),await t,this.productContainer.innerHTML="",this.productContainer.appendChild(i)}else{this.productContainer.innerHTML="";const t=document.createDocumentFragment();e.forEach(e=>{const i=this.createProductElement(e);t.appendChild(i)}),this.productContainer.appendChild(t)}this._allLoadedItems=[...e],this.animateItemsIn(this.productContainer.querySelectorAll(".collection_grid-item")),this.waitForImagesToLoad(this.productContainer.querySelectorAll("img")),g(()=>{this.initImageHover(),this.updateProductImages(),this.updateProductLinks(),this.setupProductClickTracking()},{timeout:1e3})}async appendItems(e){await this.removeSkeletonLoaders(!0),this._allLoadedItems.push(...e);const t=document.createDocumentFragment();e.forEach(e=>{const i=this.createProductElement(e);t.appendChild(i)}),this.productContainer.appendChild(t);const i=Array.from(this.productContainer.querySelectorAll(".collection_grid-item")).slice(-e.length);this.animateItemsIn(i);const s=Array.from(this.productContainer.querySelectorAll("img")).slice(4*-e.length);this.waitForImagesToLoad(s),g(()=>{this.initImageHover(),this.updateProductImages(),this.updateProductLinks(),this.setupProductClickTracking()},{timeout:1e3})}animateItemsIn(e){window.gsap&&e&&0!==e.length&&(gsap.set(e,{opacity:0,y:20}),requestAnimationFrame(()=>{gsap.to(e,{opacity:1,y:0,duration:.5,ease:"power2.out",stagger:.025,delay:.15})}))}createProductElement(e){const t=e.name||e["actual-product-name"]||"Untitled",i=e.image?.url||"https://cdn.prod.website-files.com/plugins/Basic/assets/placeholder.60f9b1840c.svg",s=`/collections/${e.slug||e.webflow_item_id||""}`,n=document.createElement("div");return n.setAttribute("role","listitem"),n.className="w-dyn-item",n.innerHTML=`\n        <div class="collection_grid-item" data-base-url="${s}" data-product-id="${s}" data-hover-initialized="false">\n          <a href="${s}" class="collection_image-cover">\n            <img src="${i}" loading="lazy" alt="${t}" class="img-2" data-original-src="${i}">\n          </a>\n          <div class="progressive-blur">\n              <div class="blur"></div>\n          </div>\n          <div class="gradient-cover"></div>\n          <div class="collection-overlay">\n            <a href="${s}" class="collection_details">\n              <div class="truncate">${t}</div>\n            </a>\n            ${this.createProductMetaHTML(e)}\n            ${this.createVariantThumbnailsHTML(e.related_items,s)}\n          </div>\n        </div>\n      `,n}createProductMetaHTML(e){return`\n        <div data-thickness="${e.thickness||""}" data-applications="${e["application-slugs"]||""}" data-material="${e.material||""}" class="product-meta">\n          ${e.featured||!1?'<div class="is-featured-flag"></div>':""}\n        </div>\n      `}createVariantThumbnailsHTML(e,t){if(!e||0===e.length)return'\n          <div class="collection-list-wrapper w-dyn-list">\n            <div role="list" class="variant_thumbnail-list w-dyn-items"></div>\n          </div>\n        ';return`\n        <div class="collection-list-wrapper w-dyn-list">\n          <div role="list" class="variant_thumbnail-list w-dyn-items">\n            ${e.map(e=>{const i=e["image-3"]?.url||"https://cdn.prod.website-files.com/plugins/Basic/assets/placeholder.60f9b1840c.svg",s=e["finish-slugs"]||"",n=this.extractColorName(e.color,e.slug),o=e["size-slugs"]||"",r=e.name||e.slug||e.webflow_item_id||"",a=e.slug||e.webflow_item_id||"";return`\n            <div role="listitem" class="w-dyn-item">\n              <a href="${a?`${t}?variant=${a}`:t}" class="variant-thumb-link" style="display: block; line-height: 0;">\n                <img src="${i}" loading="lazy" alt="${r}" class="variant-thumb" style="cursor: pointer;">\n              </a>\n              <div data-finishes="${s}" data-name="${r}" data-slug="${a}" data-color="${n}" data-sizes="${o}" class="variant-meta"></div>\n            </div>\n          `}).join("")}\n          </div>\n        </div>\n      `}extractColorName(e,t){const i={blue:"blue",green:"green",black:"black",white:"white",grey:"grey",gray:"grey"},s=(t||"").toLowerCase();for(const[e,t]of Object.entries(i))if(s.includes(e))return t;return e||""}normalizeFilterKey(e){const t=(e||"").toString().trim().toLowerCase().replace(/\s+/g,"-");return"color"===t||"colors"===t?"colors":"size"===t||"sizes"===t?"size":"finish"===t||"finishes"===t?"finish":"material"===t||"materials"===t?"material":"application"===t||"applications"===t?"application":t}updateFilters(){this.activeFilters={};this.filterForm.querySelectorAll('input[type="checkbox"]:checked').forEach(e=>{const t=e.name,i=e.value,s=this.normalizeFilterKey(t);this.activeFilters[s]||(this.activeFilters[s]=[]),this.activeFilters[s].push(i)}),this.updateFilterChips()}async applyFilters(){await this.loadInitialData(),this.updateURLParams(),this.updateProductLinks()}updateProductImages(){const e=this.activeFilters.colors||this.activeFilters.color;document.querySelectorAll(".collection_grid-item").forEach((t,i)=>{setTimeout(()=>{if(e&&1===e.length){const i=this.getVariantImageForColor(t,e[0]);i&&this.showImageOverlay(t,i.src,i.alt,!0)}else this.restoreOriginalImage(t)},1*i)})}getVariantImageForColor(e,t){const i=e.querySelectorAll(".variant-thumb"),s=t.toLowerCase();for(const e of i){const t=e.nextElementSibling;if(!t||!t.classList.contains("variant-meta"))continue;const i=t.getAttribute("data-color");if(!i)continue;if(i.split(",").map(e=>e.trim().toLowerCase()).includes(s))return{src:e.src,alt:e.alt}}return null}createImageOverlay(e,t){return`\n        <img \n          src="${e}" \n          alt="${t}" \n          loading="lazy"\n          class="img-2 overlay-img"\n          style="opacity: 0; transition: opacity 0.3s ease;"\n        >\n      `}showImageOverlay(e,t,i,s=!1){const n=e.querySelector(".collection_image-cover");if(!n)return;const o=n.querySelector(".overlay-img");o&&(o.style.opacity="0",setTimeout(()=>o.remove(),10));const r=this.createImageOverlay(t,i),a=n.querySelector(".img-2:not(.overlay-img)");if(!a)return;a.insertAdjacentHTML("afterend",r);const l=n.querySelector(".overlay-img");l&&requestAnimationFrame(()=>{l.style.opacity="1",e.dataset.hasOverlay="true",s&&(l.dataset.permanent="true",setTimeout(()=>{this.replaceMainImage(e,t,i)},300))})}hideImageOverlay(e){const t=e.querySelector(".collection_image-cover");if(!t)return;const i=t.querySelector(".overlay-img");i&&!i.dataset.permanent&&(i.style.opacity="0",setTimeout(()=>{i.parentNode&&(i.remove(),e.removeAttribute("data-has-overlay"))},300))}replaceMainImage(e,t,i){const s=e.querySelector(".img-2:not(.overlay-img)");s&&(s.src=t,s.alt=i)}restoreOriginalImage(e){const t=e.querySelector(".img-2:not(.overlay-img)"),i=e.querySelector(".overlay-img[data-permanent]");if(!t)return;const s=t.dataset.originalSrc,n=t.alt;s&&(i&&(i.style.opacity="0",setTimeout(()=>{i.parentNode&&(i.remove(),e.removeAttribute("data-has-overlay"))},300)),setTimeout(()=>{this.replaceMainImage(e,s,n)},i?300:0))}initImageHover(){const e=document.querySelectorAll(".collection_grid-item");let t=0;const i=()=>{Array.from(e).slice(t,t+5).forEach(e=>{if("true"===e.dataset.hoverInitialized)return;const t=e.querySelectorAll(".variant-thumb"),i=e.querySelector(".variant_thumbnail-list");if(0===t.length)return;let s,n=!1;i&&(i.addEventListener("mouseenter",()=>{n=!0,s&&(clearTimeout(s),s=null)},{passive:!0}),i.addEventListener("mouseleave",()=>{n=!1,s=setTimeout(()=>{this.hideImageOverlay(e)},200)},{passive:!0})),t.forEach(t=>{t.addEventListener("mouseenter",()=>{s&&(clearTimeout(s),s=null);e.querySelector(".overlay-img[data-permanent]")||this.showImageOverlay(e,t.src,t.alt,!1)},{passive:!0}),t.addEventListener("mouseleave",()=>{n||(s=setTimeout(()=>{this.hideImageOverlay(e)},200))},{passive:!0})}),e.dataset.hoverInitialized="true"}),t+=5,t<e.length&&requestAnimationFrame(i)};e.length>0&&requestAnimationFrame(i)}initProductNavigation(){}getVariantsForColor(e,t){const i=e.querySelectorAll(".variant-thumb"),s=[];return i.forEach(e=>{const i=e.nextElementSibling;if(!i||!i.classList.contains("variant-meta"))return;const n=i.getAttribute("data-color"),o=i.getAttribute("data-slug");if(!n||!o)return;n.split(",").map(e=>e.trim().toLowerCase()).includes(t)&&s.push(o)}),s}updateProductLinks(){const e=this.activeFilters.colors||this.activeFilters.color;document.querySelectorAll(".collection_grid-item").forEach(t=>{const i=t.dataset.baseUrl;if(!i)return;let s=i;if(e&&1===e.length){const n=this.getVariantsForColor(t,e[0].toLowerCase());1===n.length&&(s=`${i}?variant=${n[0]}`)}const n=t.querySelector(".collection_image-cover"),o=t.querySelector(".collection_details");n&&"A"===n.tagName&&(n.href=s),o&&"A"===o.tagName&&(o.href=s)})}initNiceSelect(){if(this.sortDropdown&&"undefined"!=typeof NiceSelect)try{this.niceSelect=NiceSelect.bind(this.sortDropdown,{searchable:!1,placeholder:"Select...",searchtext:"Search",selectedtext:"geselecteerd"})}catch(e){console.error("Failed to initialize Nice Select 2:",e)}}updateNiceSelect(e){if(this.sortDropdown)try{this.sortDropdown.value=e,this.niceSelect&&this.niceSelect.update()}catch(e){console.error("Failed to update Nice Select:",e)}}initEventListeners(){this.filterForm&&this.filterForm.addEventListener("change",async e=>{"checkbox"===e.target.type&&(this.updateFilters(),await this.applyFilters())},{signal:this._ac.signal}),this.sortDropdown&&this.sortDropdown.addEventListener("change",async e=>{this.currentSort=e.target.value,await this.applyFilters()},{signal:this._ac.signal}),this.clearButton&&this.clearButton.addEventListener("click",async e=>{e.preventDefault(),await this.clearAllFilters()},{signal:this._ac.signal}),this.initFilterChipEvents()}initInfiniteScroll(){this._observer=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&this.hasMorePages&&!this.isLoading&&(this.currentPage++,this.fetchItems(!0))})},{rootMargin:"100px",threshold:.1}),this._sentinel=document.createElement("div"),this._sentinel.style.height="1px",this._sentinel.style.position="absolute",this._sentinel.style.bottom="100px",this._sentinel.style.width="100%",this.productContainer&&this.productContainer.parentNode&&(this.productContainer.parentNode.appendChild(this._sentinel),this._observer.observe(this._sentinel))}updatePagination(e){e&&(this.totalItems=e.total||0,this.hasMorePages=e.hasMore||!1)}updateURLParams(){const e=new URLSearchParams;Object.entries(this.activeFilters).forEach(([t,i])=>{i.length>0&&e.set(t,i.join(","))}),"recommended"!==this.currentSort&&e.set("sort",this.currentSort);const t=e.toString()?`${window.location.pathname}?${e.toString()}`:window.location.pathname;window.history.replaceState({},"",t)}loadFromURLParams(){const e=new URLSearchParams(window.location.search),t=e.get("sort");t&&(this.currentSort=t,this.updateNiceSelect(t));const i={color:["color","colors","Color","Colors"],colors:["colors","color","Colors","Color"],size:["size","sizes","Size","Sizes"],sizes:["sizes","size","Sizes","Size"],finish:["finish","finishes","Finish","Finishes"],finishes:["finishes","finish","Finishes","Finish"],application:["application","applications","Application","Applications"],applications:["applications","application","Applications","Application"],"application-slugs":["application","applications","Application","Applications"],material:["material","materials","Material","Materials","material-type","materialtype"],materials:["materials","material","Materials","Material","material-type","materialtype"],thickness:["thickness","Thickness"]};let s=!1;for(const[t,n]of e.entries()){if(["sort","page","limit","config","collection_id"].includes(t))continue;if(!n)continue;const e=n.split(","),o=i[t]||[t];e.forEach(e=>{let t=null;for(const i of o)if(t=this.filterForm?.querySelector(`input[name="${i}"][value="${e}"]`),t)break;t&&(t.checked=!0,s=!0)})}s?this.updateFilters():this.updateFilterChips()}updateResultsCounter(e){this.resultsCounter&&(this.resultsCounter.textContent=e)}updateClearButton(){if(this.clearButton){const e=Object.keys(this.activeFilters).length>0;this.clearButton.style.opacity=e?"1":"0.5",this.clearButton.disabled=!e}}async clearAllFilters(){this.filterForm.querySelectorAll('input[type="checkbox"]:checked').forEach(e=>e.checked=!1),this.currentSort="recommended",this.updateNiceSelect("recommended"),this.updateFilters(),await this.applyFilters()}clearProductContainer(){this.productContainer&&(this.productContainer.innerHTML="")}updateFilterChips(){const e=document.querySelector(".filter-chip-group");e&&(e.innerHTML="",Object.entries(this.activeFilters).forEach(([t,i])=>{i.forEach(i=>{const s=document.createElement("div");s.className="filter-chip",s.setAttribute("data-chip-value",i),s.setAttribute("data-chip-filter",t);const n=this.getDisplayValueForFilter(i,t);s.innerHTML=`\n              <div class="remove-btn"><div class="text-block-4">x</div></div>\n              <div>${n}</div>\n            `,e.appendChild(s)})}))}getDisplayValueForFilter(e){return e.charAt(0).toUpperCase()+e.slice(1)}initFilterChipEvents(){document.addEventListener("click",async e=>{const t=e.target.closest(".remove-btn");if(!t)return;const i=t.closest(".filter-chip");if(!i)return;const s=i.getAttribute("data-chip-filter"),n=i.getAttribute("data-chip-value");await this.removeFilter(s,n)},{signal:this._ac.signal})}async removeFilter(e,t){const i={colors:["color","colors","Color","Colors"],color:["color","colors","Color","Colors"],size:["size","sizes","Size","Sizes"],finish:["finish","finishes","Finish","Finishes"],application:["application","applications","Application","Applications"],material:["material","materials","Material","Materials","material-type","materialtype"],thickness:["thickness","Thickness"]}[e]||[e];let s=null;for(const e of i)if(s=this.filterForm?.querySelector(`input[name="${e}"][value="${t}"]`),s)break;s&&(s.checked=!1,this.updateFilters(),await this.applyFilters())}handleError(e){console.error("Filter error:",e),this.productContainer&&(this.productContainer.innerHTML=`\n          <div class="error-message" style="grid-column:1 / -1; text-align:center; padding:2rem; background:#fee; border:1px solid #fcc; border-radius:8px; color:#c33;">\n            <h3>Error loading products</h3>\n            <p>${e.message}</p>\n            <button onclick="window.location.reload()" style="margin-top:1rem; padding:0.5rem 1rem; background:#c33; color:white; border:none; border-radius:4px; cursor:pointer;">Reload Page</button>\n          </div>\n        `)}tryRestoreFromSession(e=!1){try{const t=sessionStorage.getItem("collections_state");if(!t)return!1;const i=JSON.parse(t),s=Date.now();return s-i.timestamp>3e5?(console.log("⏰ Cache expired (>5min)"),sessionStorage.removeItem("collections_state"),!1):(this._allLoadedItems=i.allLoadedItems||[],this.activeFilters=i.activeFilters||{},this.currentSort=i.currentSort||"recommended",this.currentPage=i.currentPage||1,this.totalItems=i.totalItems||0,this.hasMorePages=void 0===i.hasMorePages||i.hasMorePages,e?this._clickedProductId=i.clickedProductId||null:(this._clickedProductId=null,this.saveToSession()),this._allLoadedItems.length>0&&(this.renderItems(this._allLoadedItems),this.updateResultsCounter(this.totalItems),e&&this._clickedProductId&&(window.__pendingScrollRestoration=this._clickedProductId),!0))}catch(e){return console.error("Failed to restore from session:",e),sessionStorage.removeItem("collections_state"),!1}}saveToSession(){try{const e={allLoadedItems:this._allLoadedItems,activeFilters:this.activeFilters,currentSort:this.currentSort,currentPage:this.currentPage,totalItems:this.totalItems,hasMorePages:this.hasMorePages,clickedProductId:this._clickedProductId,timestamp:Date.now()};sessionStorage.setItem("collections_state",JSON.stringify(e))}catch(e){console.error("Failed to save to session:",e)}}setupProductClickTracking(){this.productContainer.querySelectorAll(".collection_image-cover, .collection_details, .variant-thumb-link").forEach(e=>{e.addEventListener("click",e=>{const t=e.currentTarget.closest(".collection_grid-item");if(t){const e=t.dataset.productId||t.dataset.baseUrl;e&&(this._clickedProductId=e,this.saveToSession())}})})}waitForImagesToLoad(e){const t=e?Array.from(e):[];let i=0;const s=t.length;if(0===s)return void(window.lenis&&window.lenis.resize());window.lenis&&window.lenis.resize();const n=()=>{i++,window.lenis&&window.lenis.resize(),i===s&&window.lenis&&setTimeout(()=>window.lenis.resize(),50)};t.forEach(e=>{e.complete?n():(e.addEventListener("load",n,{once:!0}),e.addEventListener("error",n,{once:!0}))})}destroy(){this.saveToSession();try{this._ac?.abort?.()}catch(e){}try{this._observer?.disconnect?.()}catch(e){}try{this._sentinel?.remove?.()}catch(e){}}};await s.init(e),window.productFilter=s,window.InfiniteScrollProductFilter=s;const n=h("collections");u("collections",{...n,destroy:()=>{try{s.destroy()}catch(e){}}})}async function w(e){await c("https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0/dist/carousel/carousel.css"),await c("https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0/dist/fancybox/fancybox.css"),window.Carousel||await l("https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0/dist/carousel/carousel.umd.js"),window.Fancybox||await l("https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0/dist/fancybox/fancybox.umd.js"),window.Arrows||await l("https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0/dist/carousel/carousel.arrows.umd.js"),window.Dots||await l("https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0/dist/carousel/carousel.dots.umd.js"),window.Thumbs||await l("https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0/dist/carousel/carousel.thumbs.umd.js");const t=document.getElementById("product-carousel"),i=document.querySelector(".product-image"),s=document.querySelector("[data-product-name]");if(!t||!i||!s)return void u("product",{destroy:()=>{}});const n=new class{constructor(){this.slides=[],this.variants=[],this.selectedVariant=null,this.carousel=null,this.fancybox=null,this.initialSlideIndex=0,this.isInitialLoad=!0,this._ac=new AbortController,this.init()}init(){this.extractProductData(),this.determineInitialSlide(),this.buildCarousel(),this.buildVariantButtons(),this.setupFancybox();const e=document.querySelector(".variant-info");e&&(e.style.display="none"),this.handleInitialVariant()}extractProductData(){const e=document.querySelector(".product-image"),t=document.querySelector("[data-product-name]").textContent;this.slides=[{type:"main",src:e.src,alt:`${t} - Main Image`,variantSlug:null,w:1200,h:800}],this.variants=[];document.querySelectorAll(".variants-list .w-dyn-item").forEach(e=>{const i=e.children[0],s=e.querySelector("img"),n=e.querySelector(".product-variant-meta"),o={name:i.textContent,slug:n.dataset.variantSlug,image:s.src,sizes:n.dataset.sizes.split(",").map(e=>e.trim()),finishes:n.dataset.finishes.split(",").map(e=>e.trim())};this.variants.push(o),this.slides.push({type:"variant",src:o.image,alt:`${t} - ${o.name}`,variantSlug:o.slug,w:1200,h:800})})}determineInitialSlide(){const e=new URLSearchParams(window.location.search).get("variant");if(this.initialSlideIndex=0,e&&this.variants.some(t=>t.slug===e)){const t=this.slides.findIndex(t=>t.variantSlug===e);if(-1!==t)return this.initialSlideIndex=t,void(this.selectedVariant=e)}this.variants.length>0?this.selectedVariant=this.variants[0].slug:this.selectedVariant=null}buildCarousel(){const e=document.getElementById("product-carousel");if(e){e.innerHTML="",this.slides.forEach(t=>{const i=document.createElement("div");i.className="f-carousel__slide";const s=document.createElement("img");s.src=t.src,s.alt=t.alt,s.dataset.fancybox="gallery",s.dataset.src=t.src,s.dataset.caption=t.alt,s.className="carousel-image",s.style.cursor="pointer",i.appendChild(s),e.appendChild(i)});try{this.carousel=Carousel(e,{infinite:!0,center:!0,fill:!0,dragFree:!1,initialPage:this.initialSlideIndex},{Arrows:Arrows,Thumbs:Thumbs}).init()}catch(e){console.error("Failed to initialize Carousel:",e)}}}setupFancybox(){Fancybox.bind('[data-fancybox="gallery"]',{Carousel:{Toolbar:{display:{right:["zoomIn","zoomOut","thumbs","close"]}}}})}buildVariantButtons(){const e=document.querySelector(".variant-buttons");e&&(e.innerHTML="",this.variants.forEach(t=>{const i=document.createElement("button");i.className="variant-btn",i.dataset.variantSlug=t.slug,i.innerHTML=`\n          <img src="${t.image}" alt="${t.name}" class="variant-btn-image">\n          <span>${this.slugToName(t.name)}</span>\n        `,i.addEventListener("click",()=>{this.isInitialLoad=!1,this.selectVariant(t.slug,!0)},{signal:this._ac.signal}),e.appendChild(i)}))}handleInitialVariant(){if(this.selectedVariant){new URLSearchParams(window.location.search).get("variant")===this.selectedVariant?this.selectVariant(this.selectedVariant,!0,!1):this.selectVariant(this.selectedVariant,!1,!1)}setTimeout(()=>{this.isInitialLoad=!1},100)}selectVariant(e,t=!0,i=!0){if(this.selectedVariant=e,document.querySelectorAll(".variant-btn").forEach(t=>{t.classList.toggle("selected",t.dataset.variantSlug===e)}),t&&this.carousel){const t=this.slides.findIndex(t=>t.variantSlug===e);if(-1!==t)try{"function"==typeof this.carousel.slideTo?this.carousel.slideTo(t):"function"==typeof this.carousel.goTo?this.carousel.goTo(t):this.carousel.page=t}catch(e){console.error("Error navigating to slide:",e)}}this.displayVariantInfo(e),i&&this.updateURLParams()}displayVariantInfo(e){const t=document.querySelector(".variant-info");if(!e)return void(t&&(t.style.display="none"));const i=this.variants.find(t=>t.slug===e);if(!i)return void(t&&(t.style.display="none"));const s=document.querySelector(".variant-name"),n=document.querySelector(".sizes-list"),o=document.querySelector(".finishes-list");t&&s&&n&&o&&(s.textContent=this.slugToName(i.name),n.innerHTML="",o.innerHTML="",i.sizes.forEach(e=>{const t=document.createElement("div");t.className="size-item",t.textContent=this.slugToName(e),n.appendChild(t)}),i.finishes.forEach(e=>{const t=document.createElement("div");t.className="finish-item",t.textContent=this.slugToName(e),o.appendChild(t)}),t.style.display="block")}slugToName(e){return e.split(/[-_\s]+/).map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" ")}updateURLParams(){const e=new URL(window.location);this.selectedVariant?e.searchParams.set("variant",this.selectedVariant):e.searchParams.delete("variant"),window.history.replaceState(null,"",e)}destroy(){try{this._ac?.abort?.()}catch(e){}try{this.carousel?.destroy?.()}catch(e){}try{window.Fancybox&&Fancybox.destroy&&Fancybox.destroy()}catch(e){}}};u("product",{destroy:()=>n.destroy()})}function v(){if(void 0===window.taxi)return console.error("❌ Taxi.js not found! Make sure BOTH @unseenco/e AND @unseenco/taxi CDN scripts are loaded."),null;const e=r(),t=function(){const e=r();return class extends e{initialLoad(){p(),this.onEnter(),this.onEnterCompleted()}async onEnter(){await p()}}}(),s=function(){const e=r();return class extends e{initialLoad(){this.onEnter(),this.onEnterCompleted()}async onEnter(){const e=window.__taxiNavigationTrigger,t="popstate"===e;console.log("🎬 CollectionsRenderer onEnter - trigger:",e,"isBackButton:",t),await y(t)}}}(),a=function(){const e=r();return class extends e{initialLoad(){w(),this.onEnter(),this.onEnterCompleted()}async onEnter(){await w()}}}(),l=window.taxi?class extends window.taxi.Transition{onLeave({from:e,done:t}){if(!window.gsap)return void t();const i=e.getAttribute("data-taxi-view");let s=null;if("home"===i){const e=h("home");s=e?.playExitAnimation?.()}else if("collections"===i){const e=h("collections");s=e?.playExitAnimation?.()}s?s.eventCallback("onComplete",()=>{gsap.to(e,{opacity:0,duration:.3,ease:"power2.out",onComplete:t})}):gsap.to(e,{opacity:0,duration:.3,ease:"power2.out",onComplete:t})}onEnter({to:e,trigger:t,done:i}){window.gsap?(window.scrollTo(0,0),gsap.set(e,{opacity:0}),gsap.to(e,{opacity:1,duration:.3,ease:"power2.in",onComplete:i})):i()}}:(console.error("taxi not loaded!"),class{}),c=new window.taxi.Core({links:'a:not([target]):not([href^="#"]):not([data-taxi-ignore])',removeOldContent:!0,allowInterruption:!1,enablePrefetch:!0,transitions:{default:l},renderers:{default:e,home:t,collections:s,product:a}});return o(),n(),"scrollRestoration"in history&&(history.scrollRestoration="manual"),window.__taxiNavigationTrigger=null,c.on("NAVIGATE_IN",({trigger:e})=>{window.__taxiNavigationTrigger=e,console.log("🚕 NAVIGATE_IN - trigger:",e)}),c.on("NAVIGATE_OUT",({from:e})=>{i(!0),window.lenis&&(window.lenis.stop(),console.log("🛑 Stopped Lenis momentum scroll"))}),c.on("NAVIGATE_END",({to:e})=>{if(n(window.location.pathname),(()=>{if(window.Webflow&&window.Webflow.require)try{window.Webflow.destroy(),window.Webflow.ready(),window.Webflow.require("ix2").init()}catch(e){}})(),window.lenis&&(window.lenis.start(),console.log("▶️ Restarted Lenis")),window.__pendingScrollRestoration){const e=window.__pendingScrollRestoration;window.__pendingScrollRestoration=null,console.log("🔍 Executing delayed scroll restoration for:",e),setTimeout(()=>{if(window.lenis){window.lenis.resize();const t=document.querySelector(`[data-product-id="${e}"]`);if(t){const i=t.getBoundingClientRect(),s=window.pageYOffset+i.top;console.log("🎯 Smoothly scrolling to product:",e),console.log("  - Element position:",s),console.log("  - Target (with offset):",s-100),window.lenis.scrollTo(t,{duration:.6,offset:-100,easing:e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2}),setTimeout(()=>{console.log("✅ Final scroll position:",window.scrollY)},700)}else console.warn("⚠️ Product element not found:",e)}},200)}}),c.on("NAVIGATE_ERROR",e=>{console.error("❌ Navigation error:",e)}),c}console.log("%c🚕 Versatile Site v3.12.6","color: #00ff00; font-weight: bold;"),console.log("%c🎯 Show accurate skeleton count for infinite scroll","color: #00ff00;"),document.addEventListener("DOMContentLoaded",()=>{const e=v();e?(console.log("%c✅ Taxi.js ready","color: #00ff00;"),window.taxi=e):console.error("%c❌ Taxi.js failed to initialize","color: #ff0000;")})}();
